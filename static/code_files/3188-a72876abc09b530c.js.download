"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3188],{22624:(e,t,a)=>{a.d(t,{K:()=>l,p:()=>s});var n=a(64328),r=a(60687),o=a(95617),i=a(66365);let l=()=>{let e=(0,n.O9)(),t=(0,n.zc)(),a=(0,n.mV)(),{selectedTier:l,shouldOverrideFeatureAccess:s,isTierSelectorEnabled:u}=(0,r.t)(),d=(0,i.useDynamicConfig)("claude_ai_projects_limits").get("max_free_projects",0)>0,c=u&&s&&l?l===o.d7.PRO||l===o.d7.MAX||l===o.d7.ENTERPRISE:e||t||a,f=(0,i.useLayer)("trials_freemium").get("free_project",!1);return d||c||f},s=()=>{let e=(0,n.O9)(),t=(0,n.zc)(),a=(0,n.mV)(),{selectedTier:l,shouldOverrideFeatureAccess:s,isTierSelectorEnabled:u}=(0,r.t)(),d=(0,i.useDynamicConfig)("claude_ai_projects_limits"),c=(0,i.useLayer)("trials_freemium");if(u&&s&&l?l===o.d7.PRO||l===o.d7.MAX||l===o.d7.ENTERPRISE:e||t||a)return;let f=d.get("max_free_projects",0);return f>0?f:+!!c.get("free_project",!1)}},45538:(e,t,a)=>{a.d(t,{BN:()=>k,CB:()=>_,GQ:()=>T,Gz:()=>z,Kf:()=>j,LQ:()=>P,PL:()=>h,Zd:()=>q,bL:()=>C,bs:()=>x,dx:()=>m,eW:()=>M,fo:()=>w,gM:()=>y,gr:()=>v,kj:()=>K,mu:()=>Q,my:()=>Y,nl:()=>E,sC:()=>g,sS:()=>L,u7:()=>b,xQ:()=>A});var n=a(19736),r=a(1613),o=a(64328),i=a(35984),l=a(16178),s=a(80688),u=a(68067),d=a(4869),c=a(7620),f=a(10369),p=a(22624);let g=30,m=1e4;var y=function(e){return e.Student="student",e.Meeting="meeting",e.Haystack="haystack",e}({}),v=function(e){return e.Study="study",e.Career="career",e.Research="research",e.Zoom="zoom",e.Teams="teams",e.GoogleMeet="google_meet",e}({});let h=()=>{let{activeOrganization:e}=(0,o.YL)(),t=null==e?void 0:e.uuid;return(0,r.Sk)("/api/organizations/".concat(t,"/projects/count"),{queryKey:[s.Wy,{orgUuid:t}],staleTime:3e5,enabled:!!t,meta:{noToast:e=>e instanceof l.LG&&"permission_error"===e.type}})},_=e=>{let{enabled:t=!0,limit:a,offset:n,starred:i,creatorFilter:l,projectFilter:u,orderBy:d,type:c}=e,{activeOrganization:f}=(0,o.YL)(),g=(0,p.K)(),m=null==f?void 0:f.uuid,y=new URLSearchParams;return y.append("include_harmony_projects","true"),void 0!==a&&y.append("limit",a.toString()),void 0!==n&&y.append("offset",n.toString()),void 0!==i&&y.append("starred",i.toString()),void 0!==l&&y.append("creator_filter",l.toString()),void 0!==u&&y.append("filter",u.toString()),void 0!==d&&y.append("order_by",d.toString()),void 0!==c&&y.append("type",c.toString()),(0,r.Sk)("/api/organizations/".concat(m,"/projects?").concat(y.toString()),{queryKey:[s.BP,{orgUuid:m},{limit:a,offset:n,starred:i,creatorFilter:l,projectFilter:u,orderBy:d,type:c}],enabled:!!(t&&f&&g),select:e=>{let t=e.length===a;return Object.assign(e.filter(e=>!e.archived_at),{hasMore:t})}})},b=e=>{let{enabled:t=!0,limit:a=g,offset:n=0,starred:i,creatorFilter:l,projectFilter:u,orderBy:d,searchQuery:c}=e,{activeOrganization:f}=(0,o.YL)(),m=(0,p.K)(),y=null==f?void 0:f.uuid,v=new URLSearchParams;return v.append("limit",a.toString()),v.append("offset",n.toString()),void 0!==i&&v.append("starred",i.toString()),void 0!==l&&v.append("creator_filter",l.toString()),void 0!==u&&v.append("filter",u.toString()),void 0!==d&&v.append("order_by",d.toString()),void 0!==c&&v.append("searchQuery",c.toString()),(0,r.Sk)("/api/organizations/".concat(y,"/projects_v2?").concat(v.toString()),{queryKey:[s.Wf,{orgUuid:y},{limit:a,offset:n,starred:i,creatorFilter:l,projectFilter:u,orderBy:d,searchQuery:c}],enabled:!!(t&&f&&m)})},j=()=>{let{activeOrganization:e}=(0,o.YL)(),t=(0,r.mn)();return(0,c.useCallback)(async()=>(await t("/api/organizations/".concat(null==e?void 0:e.uuid,"/projects"))).json(),[null==e?void 0:e.uuid,t])},x=()=>{let e=j(),t=(0,n.uE)();return(0,c.useCallback)(async()=>{let[a,r]=await Promise.all([e(),t({limit:n.dy})]);return((e,t)=>{let a=e.map(e=>({...e,lastConversation:null==t?void 0:t.find(t=>t.project_uuid===e.uuid)})).filter(e=>e.lastConversation).sort((e,t)=>new Date(t.lastConversation.created_at).getTime()-new Date(e.lastConversation.created_at).getTime()),n=null==e?void 0:e.filter(e=>!a.find(t=>t.uuid===e.uuid));return[...a,...n]})(a,r)},[t,e])},w=e=>{let{activeOrganization:t}=(0,o.YL)(),a=null==t?void 0:t.uuid;return(0,r.Sk)("/api/organizations/".concat(a,"/projects/").concat(e),{queryKey:[s.hc,{orgUuid:a,projectUuid:e}],enabled:!!(t&&e),staleTime:0,meta:{noToast:e=>e instanceof l.LG&&(404===e.statusCode||403===e.statusCode)}})},S=()=>{let{activeOrganization:e}=(0,o.YL)(),t=null==e?void 0:e.uuid,a=(0,d.useQueryClient)();return{addProject:e=>{a.setQueriesData({queryKey:[s.Wf,{orgUuid:t}]},t=>t?{...t,data:[e,...t.data],pagination:{...t.pagination,total:t.pagination.total+1}}:t),a.setQueriesData({queryKey:[s.BP,{orgUuid:t}]},t=>t?[e,...t]:t),a.setQueriesData({queryKey:[s.Wy,{orgUuid:t}]},e=>e?{count:e.count+1}:e)},removeProject:e=>{a.setQueriesData({queryKey:[s.Wf,{orgUuid:t}]},t=>t?{...t,data:t.data.filter(t=>t.uuid!==e),pagination:{...t.pagination,total:Math.max(0,t.pagination.total-1)}}:t),a.setQueriesData({queryKey:[s.BP,{orgUuid:t}]},t=>t?t.filter(t=>t.uuid!==e):t),a.setQueriesData({queryKey:[s.Wy,{orgUuid:t}]},e=>e?{count:Math.max(0,e.count-1)}:e)}}},C=()=>{let{activeOrganization:e}=(0,o.YL)(),t=null==e?void 0:e.uuid,a=z(),{addProject:n}=S();return(0,r.L2)(()=>"/api/organizations/".concat(t,"/projects"),"POST",{onSuccess:e=>{n(e),a()}})},L=e=>{let{activeOrganization:t}=(0,o.YL)(),a=null==t?void 0:t.uuid,n=z();return(0,r.Qv)(()=>"/api/organizations/".concat(a,"/projects/").concat(e),"PUT",(e,t)=>t?{...t,...e}:void 0,{onSuccess:()=>{n(e)},queryKey:[s.hc,{orgUuid:a,projectUuid:e}]})},M=e=>{let{activeOrganization:t}=(0,o.YL)(),a=null==t?void 0:t.uuid,n=z(),{removeProject:i}=S();return(0,r.L2)(()=>"/api/organizations/".concat(a,"/projects/").concat(e),"DELETE",{onSuccess:()=>{i(e),n(e,{remove:!0})}})},P=function(e){let{limit:t=30,offset:a=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:n}=(0,o.YL)(),i=null==n?void 0:n.uuid,u=new URLSearchParams;return u.append("limit",t.toString()),u.append("offset",a.toString()),(0,r.Sk)("/api/organizations/".concat(i,"/projects/").concat(e,"/conversations_v2?").concat(u.toString()),{queryKey:[s.yF,{orgUuid:i,projectUuid:e,limit:t,offset:a}],enabled:!!n,staleTime:0,meta:{noToast:e=>e instanceof l.LG&&403===e.statusCode}})},k=()=>{var e,t;let a=_({enabled:!0,creatorFilter:"is_creator",limit:m}),n=null==(t=a.data)||null==(e=t.find(e=>e.is_starter_project))?void 0:e.uuid;return{...a,data:n}},z=()=>{let{activeOrganization:e}=(0,o.YL)(),t=null==e?void 0:e.uuid,a=(0,d.useQueryClient)();return(e,n)=>{let{remove:r=!1}=n||{};if([[s.BP,{orgUuid:t}],[s.Wf,{orgUuid:t}],[s.Wy,{orgUuid:t}]].forEach(e=>void a.invalidateQueries({queryKey:e})),e){let n=r?"removeQueries":"invalidateQueries";[[s.hc,{orgUuid:t,projectUuid:e}],[s.yF,{orgUuid:t,projectUuid:e}],[s.vE,{projectUuid:e}]].forEach(e=>void a[n]({queryKey:e}))}}},T=(e,t)=>{let a=z();return(0,r.L2)("/api/organizations/".concat(e,"/projects/").concat(t,"/report"),"POST",{enabled:!!t&&!!e,onSuccess:()=>{a(t)}})},A=e=>{let{activeOrganization:t}=(0,o.YL)(),a=null==t?void 0:t.uuid,n=(0,u.fS)("claude_ai_sticky_project_settings");return(0,r.Sk)("/api/organizations/".concat(a,"/projects/").concat(e,"/settings"),{queryKey:[s.vX,{orgUuid:a,projectUuid:e}],enabled:!!(t&&e&&n)})},Q=e=>{let{activeOrganization:t}=(0,o.YL)(),a=null==t?void 0:t.uuid,n=(0,u.fS)("claude_ai_sticky_project_settings");return(0,r.Qv)(()=>"/api/organizations/".concat(a,"/projects/").concat(e,"/settings"),"PUT",(e,t)=>t?{...t,...e}:void 0,{queryKey:[s.vX,{orgUuid:a,projectUuid:e}],enabled:!!(t&&e&&n)})},Y=()=>{let{activeOrganization:e}=(0,o.YL)(),t=null==e?void 0:e.uuid,a=(0,d.useQueryClient)();return(0,r.L2)(e=>"/api/organizations/".concat(t,"/projects/").concat(e.projectUuid,"/sync"),"POST",{meta:{noToast:!0},onSuccess:(e,n)=>{"done"===e.kb_resync_status&&n.projectUuid&&a.invalidateQueries({queryKey:[s.qz,{orgUuid:t,projectUuid:n.projectUuid}]})}})},K=()=>(0,u.fS)("claudeai_sync_project"),q=()=>{let{mutateAsync:e}=(0,n.x6)();return{moveToProject:(0,c.useCallback)(async function(t,a){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{batchSize:r=20,batchDelayMs:o=500}=n;if(!t.length||!a)return Promise.resolve({totalMoved:0,totalFailed:0,conversationUuids:[],projectUuid:""});let i=t.length>1,l=0,s=0;if(i){let n=Math.ceil(t.length/r);for(let i=0;i<n;i++){let u=i*r,d=t.slice(u,u+r),c=await e({conversation_uuids:d,project_uuid:a});l+=c.moved.length,s+=c.failed.length,i<n-1&&await new Promise(e=>setTimeout(e,o))}}else{let n=await e({conversation_uuids:t,project_uuid:a});l=n.moved.length,s=n.failed.length}return{totalMoved:l,totalFailed:s,conversationUuids:t,projectUuid:a}},[e])}},E=()=>{let{mutateAsync:e}=(0,n.x6)(),{addSuccess:t,addError:a}=(0,i.Y)(),r=(0,f.A)(),l=(0,d.useQueryClient)(),{activeOrganization:u}=(0,o.YL)(),p=null==u?void 0:u.uuid,[g,m]=(0,c.useState)(new Set),y=(0,c.useCallback)(async function(n){let{showSuccess:o=!0,showError:i=!0,onSuccess:u}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!n.length)return Promise.resolve({moved:[],failed:[]});if(n.some(e=>g.has(e)))return Promise.resolve({moved:[],failed:n});m(e=>{let t=new Set(e);return n.forEach(e=>t.add(e)),t}),n.forEach(e=>{let t=[s.fC,{orgUuid:p},{uuid:e}];l.getQueryData(t)&&l.setQueryData(t,e=>e?{...e,project_uuid:void 0}:e)});try{let a=await e({conversation_uuids:n,project_uuid:null});return a.moved.length>0&&o&&t(r.formatMessage({defaultMessage:"Chat removed from project",id:"UkGfrdMZdS"})),null==u||u(a),await Promise.all(n.map(e=>l.invalidateQueries({queryKey:[s.fC,{orgUuid:p},{uuid:e}]}))),a}catch(e){throw await Promise.all(n.map(e=>l.invalidateQueries({queryKey:[s.fC,{orgUuid:p},{uuid:e}]}))),i&&a(r.formatMessage({defaultMessage:"Failed to remove chat from project",id:"4suoYkIuEm"}),{error:e,messageForLogging:"Failed to remove chat from project"}),e}finally{m(e=>{let t=new Set(e);return n.forEach(e=>t.delete(e)),t})}},[e,t,a,r,g,l,p]),v=(0,c.useCallback)(e=>g.has(e),[g]);return{removeFromProject:y,isRemoving:g.size>0,isRemovingConversation:v}}},76737:(e,t,a)=>{a.d(t,{Si:()=>A,i1:()=>q,vV:()=>Y,fU:()=>Q});var n=a(2348),r=a(54568),o=a(44894),i=a(40925),l=a(27194),s=a(96614),u=a(86545),d=a(2327),c=a(74813),f=a(1613),p=a(64328),g=a(35984),m=a(59922),y=a(67453),v=a(16178),h=a(39613),_=a(80688),b=a(68067),j=a(30574),x=a(79289),w=a(4869),S=a(7620),C=a(59666),L=a(10369),M=a(51287),P=a(91754),k=a(47463);let z=[{matcher:e=>e.message.toLowerCase().includes("failed to fetch")||e.message.toLowerCase().includes("load failed")||e.message.toLowerCase().includes("networkerror"),createMessage:()=>(0,r.jsx)(C.A,{defaultMessage:"Upload failed due to a network issue. Check your internet connection and try again.",id:"1bxKaj0pKU"})},{matcher:e=>e.message.includes("password protected")||e.message.includes("document_password_protected"),createMessage:()=>(0,r.jsx)(C.A,{defaultMessage:"The document you uploaded is password protected. Please remove the password and try again.",id:"DHwwKwuaCR"})},{matcher:e=>e.message.includes("https://docs.claude.com/en/docs/build-with-claude/files#error-handling"),createMessage:()=>(0,r.jsx)(C.A,{defaultMessage:"The title of the document you uploaded is too long, or includes forbidden characters (<, >, :, “, |, ?, *, \\, /, or unicode characters 0-31)",id:"vC8OetMVHP"})},{matcher:e=>e.message.includes("not supported"),extractor:e=>[...new Set(e.map(e=>(0,o.QC)(e.file.name)))],createMessage:e=>(0,r.jsx)(C.A,{defaultMessage:"Files of the following {count, plural, one {format is} other {formats are}} not supported: {formats}",id:"9JcWWPAZoB",values:{count:e.length,formats:(0,r.jsx)(P.dT,{type:"conjunction",value:e})}})},{matcher:e=>e.message.includes("exceeds maximum size")||e.message.includes("File too large"),extractor:e=>e.map(e=>({file_type:e.file.type,file_size:e.file.size})),createMessage:()=>{let e=Math.floor(i.gZ/1048576);return(0,r.jsx)(C.A,{defaultMessage:"You may not upload files larger than {sizeLimit}mb.",id:"nW3gZD88Va",values:{sizeLimit:e}})},trackAnalytics:(e,t)=>{e.track({event_key:"file_upload_too_large",large_files:t})}}];function T(){let e=(0,n._)(["\n  relative\n  grid\n  place-content-center\n  aspect-square\n  rounded-xl\n  cursor-pointer\n  transition\n  [fieldset:not(:disabled)_&]:hover:bg-bg-400\n  [fieldset:disabled_&]:opacity-50\n  [fieldset:disabled_&]:pointer-events-none\n  focus-within:ring\n  inline-flex\n  items-center\n  justify-center\n  relative\n  shrink-0\n  ring-offset-2\n  ring-offset-bg-300\n  ring-accent-main-100\n  focus-visible:outline-none\n  focus-visible:ring-1\n  disabled:pointer-events-none\n  disabled:opacity-50\n  disabled:shadow-none\n  disabled:drop-shadow-none\n  bg-[radial-gradient(ellipse,_var(--tw-gradient-stops))]\n  from-bg-500/10\n  from-50%\n  to-bg-500/30\n  border-0.5\n  border-border-400\n  font-medium\n  font-ui\n  text-text-100/90\n  transition-colors\n  active:bg-bg-500/50\n  hover:text-text-000\n  hover:bg-bg-500/60\n"]);return T=function(){return e},e}function A(e){let{syncSourceCount:t,files:a,setFiles:n,numExistingConversationFiles:l,attachments:d,setAttachments:c,numExistingConversationAttachments:f,detectSameAttachment:p,selectedModel:m,blobFileUploadsEnabled:v,conversationUuid:h,wiggleEnabled:_}=e,{addError:b}=(0,g.Y)(),w=(0,s.Z3)(null);return function(e){let{syncSourceCount:t,onUploadComplete:a,existingAttachments:n,existingFiles:l,numExistingConversationAttachments:s,numExistingConversationFiles:d,selectedModel:c,blobFileUploadsEnabled:f,conversationUuid:p,wiggleEnabled:g}=e,m=(0,L.A)(),{modelConfig:v}=(0,u.fC)(c),h=v.image_in,[_,b,w,M]=function(e){let{syncSourceCount:t,onUploadComplete:a,existingAttachments:n,existingFiles:o,numExistingConversationFiles:l,selectedModel:s,blobFileUploadsEnabled:d,conversationUuid:c,wiggleEnabled:f}=e,{modelConfig:p}=(0,u.fC)(s),g=p.image_in,m=q()&&p.pdf_in,{isUploading:y,setIsUploading:v,handleError:h,handleUpload:_}=Y({imagesEnabled:g,blobFileUploadsEnabled:d,onUploadComplete:a,rasterizePdfUploadsEnabled:m,conversationUuid:c,wiggleEnabled:f}),b=(0,S.useCallback)(e=>{let{newUploads:a=[],numNewPotentialAttachments:s=0,showError:u=!0}=e;if(s+a.length+(n.length+o.length+t)>i.XA.maxTotalUploadsPerMessage)return u&&h((0,r.jsx)(C.A,{defaultMessage:"You can add at most {count, plural, one {# attachment} other {# attachments}} to a message. Please select fewer attachments.",id:"qxV00r12ob",values:{count:i.XA.maxTotalUploadsPerMessage}})),!1;let c=l||0,{messageFileCount:f}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=0,n=0,r=0;for(let o of e){let{willBecomeMessageFile:e,category:l}=function(e){var t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(null==(t=e.name.split(".").pop())?void 0:t.toLowerCase())||"";return i.h8.includes(n)?{category:"image",willBecomeMessageFile:!!a.imagesEnabled}:i.Ap.includes(n)?{category:"pdf",willBecomeMessageFile:!!a.rasterizePdfUploadsEnabled,requiresFeatureGate:"janus_claude-ai"}:i.PC.includes(n)?{category:"out-of-context",willBecomeMessageFile:!!a.blobFileUploadsEnabled,requiresFeatureGate:"ooc_attachments"}:i.BA.includes(n)?{category:"text",willBecomeMessageFile:!1}:i.pH.includes(n)?{category:"document",willBecomeMessageFile:!1}:{category:"unsupported",willBecomeMessageFile:!1}}(o,t);"unsupported"===l?r++:e?a++:n++}return{messageFileCount:a,messageAttachmentCount:n,unsupportedCount:r}}(a,{blobFileUploadsEnabled:d,imagesEnabled:g,rasterizePdfUploadsEnabled:m});if(c+f>i.XA.maxFilesPerConversation){var p;return u&&h((p=i.XA.maxFilesPerConversation,(0,r.jsx)(C.A,{defaultMessage:"You can add at most {count, plural, one {# file} other {# files}} to a chat. {suggestion}",id:"QyrCxYs5Jy",values:{count:p,suggestion:c<p?(0,r.jsx)(C.A,{defaultMessage:"Please select fewer files.",id:"a6KVizNPLe"}):(0,r.jsx)(C.A,{defaultMessage:"Please consider starting a new chat.",id:"oN0R8lZNm6"})}}))),!1}return!0},[n,o,t,h,d,l,g,m]);return[y,v,b,(0,S.useCallback)(async e=>{b({newUploads:e})&&await _(e)},[_,b])]}({syncSourceCount:t,onUploadComplete:a,existingFiles:l,existingAttachments:n,numExistingConversationFiles:d,numExistingConversationAttachments:s,selectedModel:c,blobFileUploadsEnabled:f,conversationUuid:p,wiggleEnabled:g}),P=function(e){let{handleUpload:t}=e,a=(0,S.useRef)({ready:0,total:0}),n=(0,S.useCallback)(()=>{a.current={ready:0,total:0}},[]),r=(0,S.useCallback)(e=>{a.current.ready+=1,a.current.total===a.current.ready&&t(e)},[t]),o=(0,S.useCallback)((e,t)=>{let n=e.length;for(let i=0;i<n;i++){let n=e[i];n.isFile?(a.current.total+=1,n.file(e=>{t.push(e),r(t)})):n.isDirectory&&n.createReader().readEntries(e=>{o(e,t)})}},[r]);return(0,S.useCallback)(e=>{var t;e.preventDefault(),n();let a=null==(t=e.dataTransfer)?void 0:t.items;if(!a)return;let r=[];for(let e=0;e<(null==a?void 0:a.length);e++){let t=a[e].webkitGetAsEntry();t&&r.push(t)}o(r,[])},[o,n])}({handleUpload:M}),k=(0,S.useCallback)(async e=>{let t=Array.from(e).map(e=>new File([e],"".concat(Date.now(),"_").concat(e.name),{type:e.type,lastModified:e.lastModified}));await M(t)},[M]),z=(0,S.useCallback)(async e=>{let t=e.target.files;t&&await M(Array.from(t)),e.target.value=""},[M]),T=Math.floor(i.XA.maxFileSize/1048576),A=h?(0,r.jsx)(C.A,{defaultMessage:"Upload docs or images to Claude\\n(Max {maxUploads}, {maxSize}mb each)",id:"TGYeob9u0b",values:{maxUploads:i.XA.maxTotalUploadsPerMessage,maxSize:T}}):(0,r.jsx)(C.A,{defaultMessage:"Add content ({maxUploads} max, {maxSize}mb each)\\nAccepts pdf, txt, csv, etc.",id:"rW/kw78ou7",values:{maxUploads:i.XA.maxTotalUploadsPerMessage,maxSize:T}}),Q=(0,S.useCallback)(e=>{z(e)},[z]),E=(0,S.useMemo)(()=>({type:"file",accept:g?"":(0,o.cm)({imagesEnabled:h,outOfContextFilesEnabled:f}).join(","),onChange:Q,multiple:!0,"aria-label":m.formatMessage({defaultMessage:"Upload files",id:"2jjdVzJX0c"})}),[h,f,g,Q,m]);return[_,b,w,P,k,M,(0,r.jsx)(y.Tooltip,{className:"text-center",tooltipContent:A,children:(0,r.jsxs)(K,{children:[(0,r.jsx)("input",{"data-testid":"file-upload",className:"absolute inset-0 -z-10 overflow-hidden rounded-xl opacity-0",...E}),_?(0,r.jsx)(j.N,{className:"animate-spin",size:18}):(0,r.jsx)(x.x,{size:18,weight:"light"})]})},"upload-tooltip"),E]}({syncSourceCount:t,onUploadComplete:(0,S.useCallback)(async(e,t)=>{if(p&&e.find(e=>p(e.extracted_content)))return void b((0,r.jsx)(C.A,{defaultMessage:"The same attachment was already added earlier. Claude sees the full conversation when replying, so there’s no need to re-upload.",id:"Uo3qvhGn7z"}));c(t=>[...t,...e]),n(e=>[...e,...t]),await Promise.resolve()},[p,b,c,n]),existingAttachments:d,existingFiles:a,numExistingConversationAttachments:f,numExistingConversationFiles:l,selectedModel:null!=m?m:w,blobFileUploadsEnabled:v,conversationUuid:h,wiggleEnabled:_})}let Q=()=>{let e=(0,f.mn)(),t=(0,w.useQueryClient)();return async(a,n,r)=>{let o=new FormData;o.append("file",a);let i=r?"/api/organizations/".concat(n,"/projects/").concat(r,"/upload"):"/api/".concat(n,"/upload"),l=await e(i,{method:"POST",body:o}),s=await l.json();if(l.ok)return r&&t.invalidateQueries({queryKey:[_.qz,{orgUuid:n,projectUuid:r}]}),s;throw(0,v.a5)({status:l.status,response:s,fallbackMessage:"File upload failed",headers:l.headers,endpoint:i,method:"POST"})}},Y=e=>{var t;let{imagesEnabled:a,blobFileUploadsEnabled:n,rasterizePdfUploadsEnabled:o,onUploadComplete:s,onError:u,projectUuid:f,conversationUuid:m,wiggleEnabled:y}=e,{activeOrganization:_}=(0,p.YL)(),b=null!=(t=null==_?void 0:_.uuid)?t:"",[j]=(0,d.d)(),x=m||j,[w,L]=(0,S.useState)(!1),{addError:P}=(0,g.Y)(),T=(()=>{let{addError:e}=(0,g.Y)();return(0,S.useCallback)((t,a)=>{if(t instanceof v.LG){if("rate_limit_error"===t.type)return void e((0,r.jsxs)("p",{children:[(0,r.jsx)(C.A,{defaultMessage:"You’ve reached your limit for {resourceType} uploads. Please try again later.",id:"M88GeEDB7r",values:{resourceType:a}}),(0,r.jsx)(k.W,{})]}),{error:t});if("document_password_protected"===t.errorCode)return void e((0,r.jsx)("p",{children:(0,r.jsx)(C.A,{defaultMessage:"The document you uploaded is password protected. Please remove the password and try again.",id:"DHwwKwuaCR"})}),{error:t})}if(t instanceof v.LG&&"Image is too large"===t.message)return void e((0,r.jsx)("p",{children:(0,r.jsx)(C.A,{defaultMessage:"Image is too large. <link>Learn more</link>",id:"SFbt+MAvby",values:{link:e=>(0,r.jsx)("a",{href:"https://support.anthropic.com/en/articles/9002500-what-kinds-of-images-can-i-upload-to-claude-ai",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-accent-main-100",children:e})}})}),{error:t});e((0,r.jsx)("p",{children:(0,r.jsx)(C.A,{defaultMessage:"Your {resourceType} upload failed. Please try again.",id:"ymWsV10Pz1",values:{resourceType:a}})}),{error:t})},[e])})(),A=(0,S.useCallback)(e=>{L(!1),P(e,{errorContext:{tags:{source:"file_upload"}}}),u&&u()},[P,u,L]),Q=(0,c.st)(),Y=(0,S.useCallback)(async(e,t)=>{L(!0);try{if(!b)throw Error("Organization not loaded. Please try again.");let u=(0,l.e)(),d=(0,l.O)(e),c=function(e){let{orgUuid:t,projectUuid:a,conversationUuid:n,imagesEnabled:r,rasterizePdfUploadsEnabled:o,blobFileUploadsEnabled:l,wiggleEnabled:s}=e;return{orgUuid:t,projectUuid:a,conversationUuid:n,modelConfig:{image_in:r,pdf_in:o},featureGates:{janus_claude_ai:o,ooc_attachments:l,use_canvas_resize:!0,wiggleEnabled:s},limits:i.XA}}({orgUuid:b,projectUuid:f,conversationUuid:x,imagesEnabled:a,rasterizePdfUploadsEnabled:o,blobFileUploadsEnabled:n,wiggleEnabled:y}),p=await u.processFiles(d,c),{attachments:g,files:m,errors:v}=function(e){let t=[],a=[],n=[];for(let n of e.successful){let e=n.data;"attachment"===n.type?"extracted_content"in e&&t.push(e):"file_kind"in e&&a.push(e)}for(let t of e.failed)n.push({file:t.file,error:t.error});return{attachments:t,files:a,errors:n}}(p);if(function(e,t,a){if(0===e.length)return!1;for(let n of z){let r=e.filter(e=>n.matcher(e.error));if(r.length>0){let e=n.extractor?n.extractor(r):r;return n.trackAnalytics&&n.trackAnalytics(a,e),t(n.createMessage(e)),!0}}for(let a of e)if(a.error instanceof M.o)return t((0,M.B)(a.error)),!0;return e.forEach(e=>t(e.error.message)),!0}(v,A,Q))return;let _=function(e,t,a){if(void 0===t||0===e.length)return e;let n=0,o=[];for(let i of e){if((n+=new Blob([i.extracted_content]).size/h.t2)>t)return a((0,r.jsx)(C.A,{defaultMessage:"Failed to upload file {filename}. Project knowledge exceeds maximum. Remove files to continue.",id:"MbvF6K3PJd",values:{filename:i.file_name}})),[];o.push(i)}return o}(g,t,A);if(0===_.length&&g.length>0)return;(_.length>0||m.length>0)&&await s(_,m)}catch(t){if(function(e,t){return e instanceof Error?(e.isRateLimit?t((0,r.jsx)(C.A,{defaultMessage:"Too many file upload attempts. Please wait and try again later.",id:"h/6cMHSn1V"})):413===e.statusCode||"file_too_large"===e.errorType?t((0,r.jsx)(C.A,{defaultMessage:"Uploaded file is too large. Try uploading a smaller part of the document, or copy/pasting an excerpt from the file.",id:"/mCoauj3Ws"})):"extraction_failed"===e.errorType?t((0,r.jsx)(C.A,{defaultMessage:"The file format may not be supported or the file may be corrupted.",id:"CvPTXPZIw8"})):t((0,r.jsx)(C.A,{defaultMessage:"One or more file uploads have failed. Please try again.",id:"FIwcYDeyIC"})),!0):(t((0,r.jsx)(C.A,{defaultMessage:"One or more file uploads have failed. Please try again.",id:"FIwcYDeyIC"})),!0)}(t,A))return;let e="file";t instanceof Error&&t.message.includes("image")&&(e="image"),T(t,e)}finally{L(!1)}},[n,s,a,x,A,T,b,Q,o,f,y]);return{isUploading:w,setIsUploading:L,handleError:A,handleUpload:Y}},K=m.J.label(T()),q=()=>(0,b.fS)("janus_claude-ai")},86545:(e,t,a)=>{a.d(t,{A9:()=>p,Wq:()=>g,fC:()=>c,gI:()=>m});var n=a(1613),r=a(64328),o=a(80688),i=a(68067),l=a(95617),s=a(24407);let u={image_in:!0,pdf_in:!1},d=s.z.array(i.xR),c=e=>{let{activeOrganization:t}=(0,r.YL)(),a=null==t?void 0:t.uuid,{data:i,isLoading:l,isPlaceholderData:s}=(0,n.Sk)("/api/organizations/".concat(a,"/model_configs/").concat(e),{queryKey:[o.yV,a,e],enabled:!!a,staleTime:3e5,meta:{noToast:!0}});return{isLoading:l,modelConfig:!s&&i||u}},f=[],p=()=>{var e;let t=(0,i.fS)("backend_model_config"),{activeOrganization:a}=(0,r.YL)(),n=(0,r.h0)(),o=(0,i.T9)("claude_ai_models","models",f,l.KQ),s=t?null!=(e=null==a?void 0:a.claude_ai_bootstrap_models_config)?e:f:o,u=(0,i.P0)("claude_ai_free_tier_default","use_obfuscated_model_names",!1,i.Km),d=(0,i.T9)("claude_ai_model_selector_obfuscated_names","models",null,l.KQ.nullable()),c=!n&&u&&d?d:s,p=c.filter(e=>!e.inactive),g=p.filter(e=>!e.overflow),m=p.filter(e=>e.overflow);return{allModelOptions:c,activeModelOptions:p,mainModels:g,overflowModels:m}},g=()=>{let{allModelOptions:e}=p();return(t,a)=>{let n=e.find(e=>e.model===t);if(!n)return!1;let r=null==n?void 0:n.capabilities;return!r||!1!==r[a]}},m=()=>{let e=(0,r.h0)(),t=(0,i.P0)("claude_ai_free_tier_default","non_default_models_available",[],d);return e?[]:t}},93714:(e,t,a)=>{a.d(t,{CO:()=>f,M3:()=>u,bG:()=>d,ks:()=>g,pz:()=>s,z_:()=>c});var n=a(1613),r=a(64328),o=a(80688),i=a(4869),l=a(22167);let s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:a}=(0,r.YL)(),o=null==a?void 0:a.uuid,i=p(),s=(0,l.eL)();return(0,n.L2)(()=>"/api/organizations/".concat(o,"/projects/").concat(e,"/syncs"),"POST",{enabled:!!(a&&e),...t,onSuccess:function(){for(var a,n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];i(e),null==(a=t.onSuccess)||a.call(t,...r)},onError:function(){for(var e,a=arguments.length,n=Array(a),r=0;r<a;r++)n[r]=arguments[r];null==(e=t.onError)||e.call(t,...n);let[o,i]=n;s(o,i)}})},u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:a}=(0,r.YL)(),o=null==a?void 0:a.uuid,i=p();return(0,n.L2)(()=>"/api/organizations/".concat(o,"/projects/").concat(e,"/syncs"),"PUT",{enabled:!!(a&&e),...t,onSuccess:function(){for(var a,n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];i(e),null==(a=t.onSuccess)||a.call(t,...r)}})},d=e=>{let{activeOrganization:t}=(0,r.YL)(),a=null==t?void 0:t.uuid,i=p();return(0,n.Qv)(t=>"/api/organizations/".concat(a,"/projects/").concat(e,"/syncs/").concat(t),"DELETE",(e,t)=>t?t.filter(t=>t.uuid!==e):t,{queryKey:[o.LV,{orgUuid:a,projectUuid:e}],enabled:!!t,onSuccess:()=>{i(e)}})},c=e=>{let{activeOrganization:t}=(0,r.YL)(),a=null==t?void 0:t.uuid,i=p();return(0,n.Qv)(()=>"/api/organizations/".concat(a,"/projects/").concat(e,"/syncs/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.sync_source_uuids.includes(t.uuid)):t,{queryKey:[o.LV,{orgUuid:a,projectUuid:e}],enabled:!!t,onSuccess:()=>{i(e)}})},f=function(e,t){let a=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{activeOrganization:s}=(0,r.YL)(),u=null==s?void 0:s.uuid,d=(0,i.useQueryClient)(),c=!!(s&&e&&a),{data:f,isLoading:p}=(0,n.Sk)("/api/organizations/".concat(u,"/projects/").concat(e,"/syncs?calculate_size=").concat(null!=t&&t),{queryKey:[o.LV,{orgUuid:u,projectUuid:e,calculateSize:t}],enabled:c,refetchInterval:e=>{var t;return(null==(t=e.state.data)?void 0:t.some(l.z3))?5e3:3e5},structuralSharing:(t,a)=>{let n=void 0!==t&&t.some(l.z3),r=void 0!==a&&a.some(l.z3);return n&&!r&&d.invalidateQueries({queryKey:[o.qz,{orgUuid:u,projectUuid:e}]}),a}});return{data:f,isLoading:!!c&&p}},p=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid,a=(0,i.useQueryClient)();return e=>{a.invalidateQueries({queryKey:[o.LV,{orgUuid:t,projectUuid:e}]}),a.invalidateQueries({queryKey:[o._G,{orgUuid:t,projectUuid:e}]}),a.invalidateQueries({queryKey:[o.qz,{orgUuid:t,projectUuid:e}]})}},g=e=>{let{data:t}=f(e);return!!(null==t?void 0:t.some(l.z3))}},94028:(e,t,a)=>{a.d(t,{Bg:()=>u,fR:()=>f,iV:()=>c,ih:()=>d,nI:()=>p});var n=a(1613),r=a(64328),o=a(35984),i=a(80688),l=a(2e3),s=a(4869);let u=()=>{let{account:e,activeOrganization:t}=(0,r.YL)(),a=null==e?void 0:e.uuid,o=null==t?void 0:t.uuid,u=(0,s.useQueryClient)();return(0,n.L2)("/api/organizations/".concat(o,"/sync/mcp/drive/ingest"),"POST",{onSuccess:()=>{setTimeout(()=>{u.invalidateQueries({queryKey:[i.hx,{orgUuid:o,accountUuid:a,syncSourceType:l.v8.GDRIVE}]})},300)}})},d=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid,{addError:a}=(0,o.Y)(),u=(0,s.useQueryClient)();return(0,n.L2)("/api/organizations/".concat(t,"/sync/ingestion/gdrive/clean_up"),"POST",{onSuccess:()=>{u.invalidateQueries({queryKey:[i.hx,{orgUuid:t,syncSourceType:l.v8.GDRIVE}]})},onError:e=>{a(e.message,{error:e,errorContext:{tags:{source:"knowledge_cleanup_ingestion"}}})}})},c=e=>{let{activeOrganization:t}=(0,r.YL)(),a=null==t?void 0:t.uuid,o=(0,s.useQueryClient)();return(0,n.L2)("/api/organizations/".concat(a,"/projects/").concat(e,"/kb/resync"),"POST",{enabled:!!e,meta:{noToast:!0},onSuccess:t=>{"done"===t.status&&o.invalidateQueries({queryKey:[i.qz,{orgUuid:a,projectUuid:e}]})}})},f=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:a}=(0,r.YL)(),o=null==a?void 0:a.uuid;return(0,n.Sk)("/api/organizations/".concat(o,"/projects/").concat(e,"/kb/stats"),{queryKey:[i.qz,{orgUuid:o,projectUuid:e}],enabled:!!e&&t})},p=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid;return(0,n.L2)("/api/organizations/".concat(t,"/conversation/backfill"),"POST",{})}}}]);