"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6614],{13013:(e,t,n)=>{n.d(t,{r:()=>r});function r(e,t){return Object.fromEntries(Object.entries(t).map(t=>{let[n,r]=t;return[n.startsWith("".concat(e,"."))?n:"".concat(e,".").concat(n),r]}))}},24024:(e,t,n)=>{n.d(t,{C:()=>o});var r=n(60696),a=n(7397),i=n(58936);class s{extractFromServerTiming(){try{let e=performance.getEntriesByType("navigation");if(0===e.length)return;let t=e[0].serverTiming;if(!t)return;let n=t.find(e=>"traceparent"===e.name);if(!n||!n.description)return;let i=n.description.split("-");if(4!==i.length)return;let[s,o,l,u]=i;if("00"!==s)return;this.parentContext={traceId:o,spanId:l,traceFlags:parseInt(u,16),isRemote:!0};let c=r.u.wrapSpanContext(this.parentContext);this.contextWithParent=r.u.setSpan(a.l,c)}catch(e){}}setParentContext(e){this.parentContext=e}getParentContext(){return this.parentContext}isParentSampled(){return!!this.parentContext&&(1&this.parentContext.traceFlags)==1}getContextWithParent(){if(!this.parentContext)return null;let e=r.u.wrapSpanContext(this.parentContext);return r.u.setSpan(i._.active(),e)}clearParentContext(){this.parentContext=null,this.contextWithParent=null}hasParentContext(){return null!==this.parentContext}active(){return this.contextWithParent||a.l}with(e,t,n){for(var r=arguments.length,a=Array(r>3?r-3:0),i=3;i<r;i++)a[i-3]=arguments[i];return t.call(n,...a)}bind(e,t){return t}enable(){return this.initialized||(this.extractFromServerTiming(),this.initialized=!0),this}disable(){return this.parentContext=null,this.contextWithParent=null,this.initialized=!1,this}constructor(){this.initialized=!1,this.parentContext=null,this.contextWithParent=null}}let o=new s},40419:(e,t,n)=>{n.d(t,{v:()=>i,x:()=>s});var r=n(7620);let a="customSystemPrompt",i=()=>{let[e,t]=(0,r.useState)(()=>"undefined"==typeof localStorage?"":localStorage.getItem(a)||"");return(0,r.useEffect)(()=>{localStorage.setItem(a,e)},[e]),{customSystemPrompt:e,setCustomSystemPrompt:t}},s=()=>"undefined"==typeof localStorage?"":localStorage.getItem(a)},42248:(e,t,n)=>{n.d(t,{r:()=>h});var r=n(58936),a=n(13013),i=n(68067);let s={};var o=n(60696);let l={};var u=n(99731),c=n(24024);let d="performance";function h(e){let{metricType:t=e.replace(/^.+?\./,""),duration:n=0,attributes:h={},performanceAttributes:m={},tracer:p=(!l.tracer&&(l.tracer=o.u.getTracer("claude-ai-performance","1.0.0")),l.tracer)}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},_=c.C.getContextWithParent(),f=Date.now(),g=n>0?f-n:f,v=_?r._.with(_,()=>p.startSpan(e,{startTime:g})):p.startSpan(e,{startTime:g}),x="".concat(d,".").concat(t),k={...h,["".concat(d,".metric_type")]:t,...(0,a.r)(x,m),...function(){if(s.attributes)return s.attributes;let e=(0,i.Je)(),t=(0,a.r)("statsig",{no_more_smoother:null==e?void 0:e.getExperiment("no_more_smoother_2",{disableExposureLog:!0}).get("no_smoothing",void 0),prog_chat_input:null==e?void 0:e.checkGate("prog_chat_input",{disableExposureLog:!0})});return e&&(s.attributes=t),t}()};n>0&&(k["".concat(x,".duration_ms")]=n,k.duration_ms=n);let y=(0,u.l)();y&&(k["memory.used_js_heap_size"]=y.usedJSHeapSize,k["memory.total_js_heap_size"]=y.totalJSHeapSize,k["memory.js_heap_size_limit"]=y.jsHeapSizeLimit,k["memory.heap_usage_percent"]=y.heapUsagePercent),v.setAttributes(k),v.end(f)}},45607:(e,t,n)=>{n.d(t,{Z:()=>a});class r{setVisibilityCheck(e){this.checkFn=e}clearVisibilityCheck(){this.checkFn=null}isVisible(){return!this.checkFn||this.checkFn()}constructor(){this.checkFn=null}}let a=new r},47463:(e,t,n)=>{n.d(t,{W:()=>c});var r=n(54568),a=n(44995),i=n(64328),s=n(19664),o=n.n(s),l=n(59666);let u=()=>{let e=(0,a.fZ)(),{websiteBaseUrl:t}=(0,a._r)();return(0,r.jsx)(r.Fragment,{children:e?(0,r.jsx)(l.A,{defaultMessage:"For higher limits, <link>explore our Pro plan</link>.",id:"lU28LDdk7g",values:{link:e=>(0,r.jsx)("a",{href:"/upgrade/pro",className:"font-bold underline",rel:"noreferrer",children:e})}}):(0,r.jsx)(l.A,{defaultMessage:"Or <link>contact sales</link> if you would be interested in upgrading to a paid version of Claude.",id:"3hk4yMCf5v",values:{link:e=>(0,r.jsx)(o(),{href:"".concat(t,"/contact-sales"),className:"font-bold underline",children:e})}})})};function c(){let e=(0,i.UC)(),t=(0,i.r$)();return e&&!t?(0,r.jsx)(u,{}):null}},56030:(e,t,n)=>{n.d(t,{U:()=>l});var r=n(1613),a=n(64328),i=n(68067),s=n(4869),o=n(7620);let l=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{activeOrganization:n}=(0,a.YL)(),l=(0,s.useQueryClient)(),u=null==n?void 0:n.uuid,c=(0,i.fS)("claudeai_completion_status_sidebar"),{data:d,refetch:h}=(0,r.Sk)("/api/organizations/".concat(u,"/chat_conversations/").concat(e,"/completion_status?poll=false"),{enabled:void 0!==e&&void 0!==u&&c&&!t,refetchInterval:e=>{var t,n;return null!=e&&null!=(n=e.state)&&null!=(t=n.data)&&!!t.is_pending&&1e3},retry:!1});return{completionStatus:d,refetchCompletionStatus:h,setCompletionStatus:(0,o.useCallback)(t=>{if(!c||void 0===e||void 0===u)return;let n="/api/organizations/".concat(u,"/chat_conversations/").concat(e,"/completion_status?poll=false");return l.setQueryData([n,void 0],{is_pending:t,is_error:!1,error_code:null,error_detail:null})},[e,u,l,c])}}},60687:(e,t,n)=>{n.d(t,{TierSelectorProvider:()=>d,t:()=>c});var r=n(54568),a=n(39613),i=n(68067),s=n(95617),o=n(7620),l=n(55562);let u=(0,o.createContext)(null),c=()=>{let e=(0,o.useContext)(u);if(!e)throw Error("useTierSelector must be used within a TierSelectorProvider");return e},d=e=>{let{children:t,initialEnabled:n=!1}=e,c=(0,l.l)(),[d,h]=(0,o.useState)(()=>c.get(a.eT.SELECTED_TIER)||null),[m,p]=(0,o.useState)(()=>"true"===c.get(a.eT.SHOULD_OVERRIDE_TOKEN_LIMITS)),[_,f]=(0,o.useState)(()=>"true"===c.get(a.eT.SHOULD_OVERRIDE_FEATURE_ACCESS)),g=(0,i.fS)("internal_tier_selector"),v=null!=g?g:n,x=(0,o.useState)(v)[1],k=(0,o.useCallback)(()=>{let e=[s.d7.FREE,s.d7.PRO,s.d7.ENTERPRISE,s.d7.MAX],t=Math.floor(Math.random()*e.length);return e[t]},[]),y=(0,o.useCallback)(e=>{if(!v)return void h(e);if(null===e){let e=d||k();c.set(a.eT.SELECTED_TIER,e,{maxAgeSeconds:2592e3})}else c.set(a.eT.SELECTED_TIER,e);h(e)},[d,h,c,k,v]);(0,o.useEffect)(()=>{v?d&&c.set(a.eT.SELECTED_TIER,d):c.delete(a.eT.SELECTED_TIER)},[v,d,c]);let C=(0,o.useCallback)(e=>{if(!v)return void p(e);e?c.set(a.eT.SHOULD_OVERRIDE_TOKEN_LIMITS,"true"):c.delete(a.eT.SHOULD_OVERRIDE_TOKEN_LIMITS),p(e)},[v,c]),b=(0,o.useCallback)(e=>{if(!v)return void f(e);e?c.set(a.eT.SHOULD_OVERRIDE_FEATURE_ACCESS,"true"):c.delete(a.eT.SHOULD_OVERRIDE_FEATURE_ACCESS),f(e)},[v,c]);return(0,o.useEffect)(()=>{v||(c.delete(a.eT.SHOULD_OVERRIDE_TOKEN_LIMITS),c.delete(a.eT.SHOULD_OVERRIDE_FEATURE_ACCESS))},[v,c]),(0,r.jsx)(u.Provider,{value:{selectedTier:d,isTierSelectorEnabled:v,setSelectedTier:y,setIsTierSelectorEnabled:x,shouldOverrideTokenLimits:m,setShouldOverrideTokenLimits:C,shouldOverrideFeatureAccess:_,setShouldOverrideFeatureAccess:b},children:t})}},65816:(e,t,n)=>{n.d(t,{SC:()=>c,UW:()=>o,Xn:()=>s,ey:()=>l,lK:()=>u});var r=n(20533),a=n.n(r),i=n(40459);a().join(i.cwd(),"public/i18n"),a().join(i.cwd(),"public/i18n/secret");let s="en-US",o={"xx-LS":{name:"Long stringsSSSSSSSS"},"xx-AC":{name:"ALL CAPS"},"xx-HA":{name:"[javascript] prefixed strings"},"en-XA":{name:"Ȧȧƈƈḗḗƞŧḗḗḓ Ḗḗƞɠŀīīşħ"},"en-XB":{name:"ɥsıʅƃuƎ ıpıԐ"}};function l(e){return"".concat("secret",":").concat(e)}function u(e){return"".concat("statsig",":").concat(e)}Object.keys(o);let c=["en-US","de-DE","fr-FR","ko-KR","ja-JP","es-419","es-ES","it-IT","hi-IN","pt-BR","id-ID"]},68704:(e,t,n)=>{n.d(t,{G:()=>c});var r=n(19736),a=n(64328),i=n(80688),s=n(4869),o=n(7620),l=n(37380),u=n(91820);let c=(e,t)=>{let n=(0,s.useQueryClient)(),{activeOrganization:c}=(0,a.YL)(),d=null==c?void 0:c.uuid,h=(0,o.useRef)(void 0),m=(0,u.$)(),p=(0,o.useCallback)(async(e,t)=>{let r=[i.fC,{orgUuid:d},{uuid:e}],a=n.getQueryData(r);if(!a)throw Error("Conversation tree must be provided for append");h.current=t(a),await n.cancelQueries({queryKey:r}),n.setQueryData(r,h.current)},[n,d]),_=(0,o.useRef)(new Set),f=(0,o.useCallback)((r,a)=>{if(0!==a.length){if(e&&!_.current.has(r)&&a.some(e=>"text"===e.type&&e.text&&e.text.trim().length>0)&&(_.current.add(r),e()),t){var s,o;t(null!=(o=null==(s=h.current)?void 0:s.uuid)?o:"",r,a);return}n.setQueryData([i.fC,{orgUuid:d},{uuid:r}],()=>{let e=h.current;if(!e)throw Error("Conversation tree must be provided for incremental completion");if(!e.current_leaf_message_uuid)throw Error("Couldn't figure out where to put completion");let t=e.messageByUuid.get(e.current_leaf_message_uuid);if(!t)throw Error("New assistant message not found");return t.content=a,{...e,created_at:new Date().toISOString()}})}},[n,d,e,t]);return{onStartAppend:p,onStreamCompleted:(0,o.useCallback)((e,t,a)=>{(null==a?void 0:a.shouldRefetch)!==!1&&(n.invalidateQueries({queryKey:[i.fC,{orgUuid:d}]}),n.invalidateQueries({queryKey:["FEATURE_LIMITS",d]}));let s=h.current,o=(null==s?void 0:s.chat_messages)&&s.chat_messages.length<=2;s&&o&&!s.is_temporary&&(n.setQueriesData({queryKey:[i.DC,{orgUuid:d}],predicate:e=>{let{queryKey:t}=e,n=t[2];return!(null==n?void 0:n.starred)}},t=>!t||t.some(t=>t.uuid===e)?t:[{uuid:e,name:s.name,summary:s.summary,updated_at:s.updated_at,created_at:s.created_at,project_uuid:s.project_uuid,model:s.model,settings:s.settings,is_starred:!1},...t].slice(0,r.sk)),n.setQueryData([i.Ad,{orgUuid:d}],e=>{var t;return{is_first_conversation:!1,count:(null!=(t=null==e?void 0:e.count)?t:0)+1}})),t&&d&&m(t,d,e)},[n,m,d]),onIncrementalCompletion:f,changeDisplayedConversationPath:(0,o.useCallback)((e,t,r,a)=>{n.setQueryData([i.fC,{orgUuid:d},{uuid:e}],e=>{if(!e)throw Error("Conversation tree must be provided for changeDisplayedConversationPath");let n=(0,l.gX)(e,t,r);return n.current_leaf_message_uuid&&a&&a(n.current_leaf_message_uuid),n})},[n,d])}}},77001:(e,t,n)=>{n.d(t,{O0:()=>s,Vm:()=>i,yz:()=>a});var r=n(40459);let a=()=>!1,i=()=>!!r.env.NEXT_PUBLIC_INTEGRATION_TEST,s=()=>a()},79412:(e,t,n)=>{n.d(t,{ep:()=>k,OZ:()=>v,xD:()=>C});var r=n(55562),a=n(42248),i=n(16178),s=n(39613),o=n(73356);async function l(){let{numPrevAttempts:e=1,maxAttempts:t=10,jitterFraction:n=.1,backoffAmount:r=1.5,initialDelayMs:a=1e3}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e<0)throw Error("numPrevAttempts must be non-negative");let i=a*Math.pow(r,Math.min(t,e)),s=(Math.random()-.5)*2*(i*n),l=Math.floor(Math.max(0,i+s));return o.v.debug(o.u.LOCAL_DEV,"exponentialBackoffWithJitter: Waiting ".concat(l," ms")),new Promise(e=>{setTimeout(e,l)})}var u=n(40778),c=n(96549),d=n(56929);let h=(e,t,n)=>{let{blockSize:r,sliceBlock:a}=e,i=[];if(n<=0)return[];let s=0;for(let e of t){if(s+r(e)>=n){i.push(a(e,n-s));break}i.push(e),s+=r(e)}return i},m=1e3/60;class p{_get_smoothed_completion(){var e,t,n;if(0===this.start)return[];if(this.x>=this.totalCompletionLength)return this.smoothed_completion_is_unchanged=!0,h(this.blockOperations,this.blocksList,this.totalCompletionLength);let r=(Date.now()-this.start)/1e3,a=this.arrivals[this.arrivals.length-1][1]+(this.model_done||this.force_smoother_done?100:0),i=.9*r-(null!=(n=null==(e=(t=this.blockOperations).getBlockDeadlineOffset)?void 0:e.call(t))?n:.3),s=this.arrivals.filter(e=>e[0]<i).map(e=>e[1]),o=s[s.length-1],l=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.01;if(t===n)return t;let a=e(t),i=e(n);if(t>=n)throw Error("Lower x is greater than upper x");if(a>r)throw Error("Lower f is greater than zero");if(i<-r)throw Error("Upper f is less than zero");for(;a<-r;){let r=(t+n)/2,s=e(r);s<=0?(t=r,a=s):(n=r,i=s)}return t}(e=>{let t=(e-this.x)/(r-this.t),n=1/(r-this.t);return 2*(this.force_smoother_done?.01*this.gamma:this.gamma)*n*(t-this.v)-1/(e-o)+1/(a-e)},o,a),u=(l-this.x)/(r-this.t);return this.v=this.alpha*this.v+(1-this.alpha)*u,this.smoothed_completion_is_unchanged=this.x>=this.totalCompletionLength,this.x=Math.max(l,this.x),this.t=r,this.stats.push({t:r,x:l,v:u,min_chars:o,max_chars:a}),h(this.blockOperations,this.blocksList,this.x)}get smootherDone(){return this.force_smoother_done||this.model_done&&this.x>=this.totalCompletionLength}addBlock(e,t){this.blocksList.push(t)}updateBlock(e,t){this.blocksList[e]=t}getBlocks(){return this.blocksList}onMessage(e){let t;switch(e.type){case"content_block_start":{let t=this.blockOperations.createBlockFromStartEvent(e);null!==t&&this.addBlock(e.index,t);break}case"content_block_delta":{let t=this.blocksList[e.index];if(!t)break;let n=this.blockOperations.applyDeltaEvent(e,t);this.updateBlock(e.index,n);break}case"content_block_stop":{let t=this.blocksList[e.index];if(!t)break;let n=this.blockOperations.stopBlockEvent(e,t);this.updateBlock(e.index,n);break}case"message_stop":this.model_done=!0}0===this.start&&(this.start=Date.now());let n=(t=this.blockOperations,this.blocksList.reduce((e,n)=>e+t.blockSize(n),0));if(this.totalCompletionLength=n,this.arrivals.push([(Date.now()-this.start)/1e3,n]),this.dont_smooth&&this.on_completion){let e=structuredClone(this.blocksList);this.on_completion(e)}}async task(e,t){for(;!this.smootherDone&&!t.aborted;){if(document.hidden){await new Promise(e=>setTimeout(e,200));continue}if(this.x>=this.totalCompletionLength&&this.model_done)break;if(this.blocksList.length>0){let t=this._get_smoothed_completion();this.smoothed_completion_is_unchanged||e(t)}let t=!0;if(this.checkVisibility){let e=Date.now();e-this.lastVisibilityCheck>1e3&&(this.cachedVisibility=this.checkVisibility(),this.lastVisibilityCheck=e),t=this.cachedVisibility}let n=t?m:100;await new Promise(e=>setTimeout(e,n))}}constructor(e){this.alpha=.99,this.gamma=1e-5,this.v=100,this.x=0,this.t=0,this.arrivals=[[-9999,0]],this.start=0,this.totalCompletionLength=0,this.smoothed_completion_is_unchanged=!1,this.dont_smooth=!1,this.model_done=!1,this.force_smoother_done=!1,this.stats=[],this.blocksList=[],this.lastVisibilityCheck=0,this.cachedVisibility=!0,this.blockOperations=e}}var _=n(45607);let f="POST",g=null,v=()=>{g&&(g.force_smoother_done=!0)};async function x(e){let{fn:t,maxAttempts:n,attemptNumber:r,onRetry:s,abortController:u}=e;if(n<1)throw Error("Max attempts must be >= 1");if(o.v.info(o.u.CHAT_COMPLETION,"Starting completion request (".concat(r+1,"/").concat(n,")")),r>0&&(1===r&&(0,a.r)("chat.completion_retry_initiated"),await l({numPrevAttempts:r-1,initialDelayMs:5e3,backoffAmount:1.5,jitterFraction:.1}),u.signal.aborted))throw o.v.warn(o.u.CHAT_COMPLETION,"Request aborted during backoff, stopping retries"),new DOMException("Request aborted","AbortError");try{await t(),o.v.info(o.u.CHAT_COMPLETION,"Completion request succeeded on attempt ".concat(r+1)),r>0&&(0,a.r)("chat.completion_retry_recovered");return}catch(e){if(o.v.error(o.u.CHAT_COMPLETION,"Request failed",e),1===n||!(e instanceof i.LG))throw e;if("overloaded_error"!==e.type)throw o.v.error(o.u.CHAT_COMPLETION,"Not retryable error, throwing"),(0,a.r)("chat.completion_non_retryable_error"),e;if(null==s||s(r+1),r+1>=n)throw(0,a.r)("chat.completion_retry_exhausted"),e}return x({...e,attemptNumber:r+1})}var k=function(e){return e[e.APPEND_MESSAGE_WITH_COMPLETION=1]="APPEND_MESSAGE_WITH_COMPLETION",e[e.RETRY_MESSAGE_WITH_COMPLETION=2]="RETRY_MESSAGE_WITH_COMPLETION",e}({});let y=["close_file","create_file","delete_file","file_search","open_file","repl","str_replace","update_file"];async function C(e){let t,{applicationType:n,endpoint:a,orgUuid:o,conversationUuid:l,body:h,onCompletion:m,onRetry:v,abortController:k,completion:C,getTools:b,smoothingEnabled:S=!0,retryEnabled:E=!0}=e,w=function(){let e=new Map,t=!1;return new p({blockSize:e=>{if("text"===e.type)return e.text.length;if("thinking"===e.type)return e.thinking.length;if("tool_use"===e.type){var t;return(null==(t=e.partial_json)?void 0:t.length)||0}return e.type,0},sliceBlock:(e,t)=>{if("tool_result"===e.type)return e;if("text"===e.type)return{...e,text:e.text.slice(0,t)};if("tool_use"===e.type){var n;return{...e,partial_json:null==(n=e.partial_json)?void 0:n.slice(0,t)}}return"thinking"===e.type?{...e,thinking:e.thinking.slice(0,t)}:e},createBlockFromStartEvent:e=>("thinking"===e.content_block.type&&(e.content_block.start_timestamp=new Date().toISOString()),e.content_block),applyDeltaEvent:(n,r)=>{var a,i;if("flag_delta"===n.delta.type){let e=new Set(null!=(a=r.flags)?a:[]);e.add(n.delta.flag);let t=Array.from(e);return{...r,flags:t}}switch(r.type){case"text":switch(t=!1,n.delta.type){case"text_delta":return{...r,text:r.text+n.delta.text};case"citation_start_delta":{let t=n.delta.citation;return e.set(t.uuid,{...t,start_index:r.text.length}),r}case"citation_end_delta":{let t=n.delta.citation_uuid,a=e.get(t);if(!a)return r;let i=r.citations?[...r.citations]:[];return i.push({...a,end_index:r.text.length}),{...r,citations:i}}default:return r}case"thinking":switch(t=!0,n.delta.type){case"thinking_delta":return{...r,thinking:r.thinking+n.delta.thinking};case"thinking_summary_delta":return{...r,summaries:[...r.summaries||[],n.delta.summary]};case"thinking_cut_off_delta":return{...r,cut_off:n.delta.cut_off};default:return r}case"tool_result":if(t=!1,"input_json_delta"===n.delta.type)return{...r,content:[{type:"text",text:n.delta.partial_json}]};return r;case"tool_use":if(t=!1,"input_json_delta"===n.delta.type)return{...r,partial_json:(null!=(i=r.partial_json)?i:"")+n.delta.partial_json};return r}},stopBlockEvent:(e,t)=>{if("thinking"===t.type)return{...t,stop_timestamp:e.stop_timestamp};if("tool_use"===t.type){var n;return{...t,buffered_input:null!=(n=e.buffered_input)?n:"{}"}}return t},getBlockDeadlineOffset(){if(t)return 3}})}();g=w,w.dont_smooth=!S,w.on_completion=m,w.checkVisibility=()=>_.Z.isVisible();let T=S?w.task(m,k.signal):Promise.resolve(),j=r.m.get(s.eT.DEVICE_ID_KEY),L={"Content-Type":"application/json",Accept:"text/event-stream",...(0,u._)(n),...j&&{"anthropic-device-id":j}},O=null,I=null,D=JSON.stringify({...C,...h,text:void 0,rendering_mode:"messages",organization_uuid:void 0,conversation_uuid:void 0}),A="",M="",P=0,R=x({fn:()=>{w.model_done=!1,w.force_smoother_done=!1,A="",M="",t=void 0,P=0;let e=function(e,t,n){let r;switch(e){case 1:r="completion";break;case 2:r="retry_completion";break;default:throw Error("Invalid endpoint")}return"/api/organizations/".concat(t,"/chat_conversations/").concat(n,"/").concat(r)}(a,o,l);return(0,c.y)(e,{method:f,credentials:"include",headers:L,body:D,openWhenHidden:!0,signal:k.signal,async onopen(t){var n;if(!t.ok||!(null==(n=t.headers.get("content-type"))?void 0:n.includes(c.o))){let n=await t.text(),r={};try{r=JSON.parse(n)}catch(e){}throw(0,i.a5)({status:t.status,response:r,fallbackMessage:"Failed to fetch",headers:t.headers,endpoint:e,method:f})}},onmessage:n=>{var r,a;switch(n.event){case"ping":default:return;case"error":throw(0,i.a5)({status:0,response:JSON.parse(n.data),fallbackMessage:"Streaming error: 22",headers:void 0,endpoint:e,method:f});case"completion":{let e=JSON.parse(n.data);if(void 0===e.completion)throw Error("Unexpected message received when streaming: ".concat(n.data));let t={type:"content_block_delta",index:0,delta:{type:"text_delta",text:e.completion}};O=e.stop_reason,I=null!=(r=e.messageLimit)?r:null,w.onMessage(t);break}case"content_block_start":{let e=JSON.parse(n.data);P=e.index,"tool_use"===e.content_block.type&&(M=e.content_block.name,t=e.content_block.approval_key),w.onMessage(e);break}case"content_block_delta":{let e=JSON.parse(n.data);if(e.index!==P&&"thinking_summary_delta"!==e.delta.type)throw Error("Content block index did not match the expected index");(null==(a=e.delta)?void 0:a.type)==="input_json_delta"&&(y.includes(M)||b().some(e=>e.name===M||M.endsWith(":".concat(e.name)))||t)&&(A+=e.delta.partial_json),w.onMessage(e);break}case"content_block_stop":{let e=JSON.parse(n.data);if(e.index!==P)throw Error("Content block index did not match the expected index");if(e.buffered_input=A,w.onMessage(e),!M)break;A="",M="",t=void 0;break}case"message_limit":I=JSON.parse(n.data).message_limit;break;case"message_delta":case"message_start":case"message_stop":{let e=JSON.parse(n.data);"message_stop"===e.type&&(O="message_stop"),w.onMessage(e)}}},onclose(){w.model_done=!0},onerror(e){throw(0,d.Cp)(e),w.model_done=!0,w.force_smoother_done=!0,e}})},abortController:k,attemptNumber:0,maxAttempts:E?10:1,onRetry:v});return await Promise.all([R,T]),g=null,{stopReason:O,messageLimitResult:I}}},91820:(e,t,n)=>{n.d(t,{$:()=>c,T:()=>d});var r=n(1613),a=n(64328),i=n(60687),s=n(80688),o=n(68067),l=n(4869),u=n(7620);let c=()=>{let e=(0,l.useQueryClient)();return(0,u.useCallback)((t,n,r)=>{"within_limit"!==t.type&&(t.conversationUuid=r),e.setQueryData([s.Rw],e=>e?{...e,messageLimits:{...e.messageLimits,[n]:t}}:e)},[e])},d=e=>{let{activeOrganization:t}=(0,a.YL)(),{selectedTier:n}=(0,i.t)(),s=(0,o.fS)("internal_tier_selector"),l=null==t?void 0:t.uuid,u=c(),d={type:"within_limit"};return(0,r.L2)(()=>"/api/organizations/".concat(l,"/reset_rate_limits"),"POST",{onSuccess:()=>{u(d,l,e||"")},meta:{noToast:!0},transformVariables:()=>s&&n?{org_type:n}:{}})}},96614:(e,t,n)=>{n.d(t,{c7:()=>F,Z3:()=>N,x:()=>O,Gw:()=>eo,SL:()=>el});var r=n(54568),a=n(7620),i=n(47463),s=n(39613),o=n(45312),l=n(19664),u=n.n(l),c=n(59666);function d(){return(0,r.jsx)("p",{children:(0,r.jsx)(c.A,{defaultMessage:"Claude’s response was interrupted. This can be caused by network problems or exceeding the maximum conversation length. Please <link>contact support</link> if the issue persists.",id:"sHRMIfTKu4",values:{link:e=>(0,r.jsx)(u(),{href:"https://support.anthropic.com/en/articles/9015913-how-to-get-support",className:"underline",children:e})}})})}function h(){return(0,r.jsx)(c.A,{defaultMessage:"We couldn’t connect to Claude. Please check your network connection and try again.",id:"KzO0j4cGtg"})}function m(){return(0,r.jsxs)("p",{children:[(0,r.jsx)(c.A,{defaultMessage:"You’ve reached your weekly limit for thinking messages. Please try again next week.",id:"uu/l1k2f+L"}),"\xa0",(0,r.jsx)(i.W,{})]})}function p(){return(0,r.jsx)(c.A,{defaultMessage:"Looks like you have too many chats going. Please close a tab to continue.",id:"KD5FDGzyMz"})}function _(e){let{resetsAtInSeconds:t}=e;return(0,r.jsxs)("p",{children:[(0,r.jsx)(c.A,{defaultMessage:"You’ve hit your limit for Claude messages.",id:"JR7SJGPDTb"}),"\xa0",t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.A,{defaultMessage:"Limits will reset at {resetsAt}.",id:"NrQ1CUE4v0",values:{resetsAt:o.c9.fromSeconds(t).toLocaleString(o.c9.TIME_SIMPLE).replace(" ","\xa0")}}),"\xa0",(0,r.jsx)(i.W,{}),"\xa0",(0,r.jsx)(c.A,{defaultMessage:"<link>View your usage details</link>.",id:"wWT0iz9SkP",values:{link:e=>(0,r.jsx)(u(),{href:"/settings/usage",className:"font-bold underline",children:e})}})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.A,{defaultMessage:"Please wait before trying again.",id:"XhLYQfswyj"}),"\xa0",(0,r.jsx)(i.W,{})]})]})}function f(){return(0,r.jsx)(c.A,{defaultMessage:"Claude model version not found.",id:"kdrUaXpTqd"})}function g(){return(0,r.jsx)(c.A,{defaultMessage:"This model isn’t available right now. You can switch to another model to continue using Claude.",id:"EIRohXEK72"})}function v(){return(0,r.jsx)(c.A,{defaultMessage:"Conversation not found.",id:"eePQiZiD6b"})}function x(){return(0,r.jsx)("p",{children:(0,r.jsx)(c.A,{defaultMessage:"We had an unexpected billing error, please <link>contact support.</link>",id:"MBYn4HHrFu",values:{link:e=>(0,r.jsx)("a",{className:"underline",href:"https://support.anthropic.com/en/articles/9015913-how-can-i-contact-support",target:"_blank",rel:"noreferrer",children:e})}})})}function k(){return(0,r.jsxs)("p",{children:[(0,r.jsx)(c.A,{defaultMessage:"Due to unexpected capacity constraints, Claude is unable to respond to your message. Please try again soon.",id:"TRpxX8Mu1L"}),"\xa0",(0,r.jsx)(i.W,{})]})}function y(){return(0,r.jsx)("p",{children:(0,r.jsx)(c.A,{defaultMessage:"Due to capacity constraints, chatting with Claude is currently not available. Please try again in a little while.",id:"W2dIBW8oIg"})})}function C(){return(0,r.jsx)(c.A,{defaultMessage:"Your message will exceed the maximum number of files allowed per message. Consider removing some of your files or adding files over several messages.",id:"/jNwaAHdg9"})}function b(e){let{numSanitizedDocuments:t,onNewChat:n}=e;return t>0?(0,r.jsx)(c.A,{defaultMessage:"Your message will exceed the <link>maximum image count</link> for this chat. Try uploading {count, plural, one {# document} other {# documents}} with fewer pages, removing images, <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"gltmHPfviz",values:{link:e=>(0,r.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:s.FP,children:e}),newChatLink:e=>(0,r.jsx)("a",{href:"#",className:"underline",onClick:e=>{e.preventDefault(),n()},children:e}),upgradeInstructions:()=>(0,r.jsx)(i.W,{}),count:t}}):(0,r.jsx)(c.A,{defaultMessage:"Your message will exceed the <link>maximum image count</link> for this chat. Try removing images <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"QmLhKBubcc",values:{link:e=>(0,r.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:s.FP,children:e}),newChatLink:e=>(0,r.jsx)("a",{href:"#",className:"underline",onClick:e=>{e.preventDefault(),n()},children:e}),upgradeInstructions:()=>(0,r.jsx)(i.W,{})}})}function S(e){let{numAttachmentsOrFiles:t,onNewChat:n}=e;return t>0?(0,r.jsx)(c.A,{defaultMessage:"Your message will exceed the <link>length limit</link> for this chat. Try attaching fewer or smaller files <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"G1lejdsk5p",values:{link:e=>(0,r.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:s.q4,children:e}),newChatLink:e=>(0,r.jsx)("a",{href:"#",className:"underline",onClick:e=>{e.preventDefault(),n()},children:e}),upgradeInstructions:()=>(0,r.jsx)(i.W,{})}}):(0,r.jsx)(c.A,{defaultMessage:"Your message will exceed the <link>length limit</link> for this chat. Try shortening your message <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"EWtBrIlAAR",values:{link:e=>(0,r.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:s.q4,children:e}),newChatLink:e=>(0,r.jsx)("a",{href:"#",className:"underline",onClick:e=>{e.preventDefault(),n()},children:e}),upgradeInstructions:()=>(0,r.jsx)(i.W,{})}})}function E(e){return"not_found_error"===e.type&&("chat_conversation_not_found"===e.errorCode||e.message.toLowerCase().includes("unknown chat"))}var w=n(80688),T=n(4869),j=n(27736);let L={value:null},O=()=>{let e=(0,T.useQueryClient)();return{failedStreamRetryData:(0,j.useQuery)({queryKey:[w.xT],queryFn:()=>L.value,initialData:null}).data||null,setFailedStreamRetryData:(0,a.useCallback)(t=>{L.value=t,e.setQueryData([w.xT],t)},[e])}};var I=n(19736),D=n(68067),A=n(27541),M=n(24407);let P=M.z.object({model:M.z.string().nullable()}).nullable(),R=e=>{let t=(0,I.mz)(e||""),n=(0,A.useSearchParams)(),r=null==n?void 0:n.get("model");return(null==t?void 0:t.model)?null==t?void 0:t.model:r||void 0},N=e=>{let t=R(e),n=(0,D.P0)("tepui_default_on_claude_free","model",null,D.Lu),r=(0,D.GZ)("console_default_model_override","model",null,P),a=(0,D.T9)("console_default_model","model",null,D.Lu);return t||n||(null==r?void 0:r.model)||a||"claude-3-5-haiku-latest"};var z=n(40419),H=n(65816);let W=(0,a.createContext)([null,null]);function F(e){let{children:t}=e,n=(0,a.useState)({});return(0,r.jsx)(W.Provider,{value:n,children:t})}var U=n(79412),V=n(37380),B=n(68704),Q=n(8019),J=n(56030),G=n(91820),Y=n(74813),q=n(44995),K=n(64328),X=n(35984),Z=n(16178),$=n(77001),ee=n(73356),et=n(56929),en=n(66365),er=n(10369);let ea="incomplete_stream",ei=Error(ea);function es(e){var t;let{conversationUuid:n,projectUuid:i,endpoint:s,getTools:l,onIncrementalCompletion:u,onStreamCompleted:c,onRetry:w}=e,T=(0,Y.st)(),{applicationType:j}=(0,q._r)(),{activeOrganization:L}=(0,K.YL)(),M=(0,D.fS)("apps_no_smoothing"),P=null==L?void 0:L.uuid,{context:N,clearContext:F,setContext:V}=function(e){let[t,n]=(0,a.useContext)(W),[r,i]=(0,a.useState)(),s=(0,a.useCallback)(()=>{n?n(t=>{let n={...t};return delete n[e],n}):i(void 0)},[e,n]),o=(0,a.useCallback)(t=>{n?n(n=>({...n,[e]:t})):i(t)},[e,n]);return{context:t?t[e]:r,clearContext:s,setContext:o}}(n),B=(0,A.useSearchParams)(),es=null==B?void 0:B.get("t"),eo=null!=(t=R(n))?t:"",el=null==B?void 0:B.get("max_tokens"),eu=(0,G.$)(),{addError:ec,addApiError:ed,clearToast:eh}=(0,X.Y)(),em=(0,a.useMemo)(Q.b,[]),ep=(0,I.bT)("push",em),{setFailedStreamRetryData:e_}=O(),ef=(0,a.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shouldRefetch:!0};await (null==c?void 0:c(n,e,t)),F()},[c,n,F]),eg=(0,a.useCallback)((e,t,a)=>{if(e===ea)return ec((0,r.jsx)(d,{}),{error:e});if(!(e instanceof Z.LG))return ec((0,r.jsx)(h,{}),{error:e});if("rate_limit_error"===e.type){var s;let t=null;if(e.message.includes("{")&&P)try{t=JSON.parse(e.message),eu(t,P,n)}catch(e){}if((null==t?void 0:t.type)==="exceeded_limit"&&"concurrents"===t.representativeClaim)return void ec((0,r.jsx)(p,{}),{error:e});if("thinking_messages_rate_limit_exceeded"===e.errorCode)return void ec((0,r.jsx)(m,{}),{error:e});if("opus_messages_rate_limit_exceeded"===e.errorCode)throw e;let a=(null==t?void 0:t.type)==="exceeded_limit"&&"representativeClaim"in(s=t)&&void 0!==s.representativeClaim?t.resetsAt:void 0;return void ec((0,r.jsx)(_,{resetsAtInSeconds:a}),{error:e})}return"not_found_error"===e.type?e.message&&e.message.toLowerCase().includes("model:")?ec((0,r.jsx)(f,{}),{error:e}):E(e)?ec((0,r.jsx)(v,{}),{error:e}):"model_not_available"===e.errorCode&&e.message?ec(e.message,{error:e}):(T.track({event_key:"claudeai.unhandled_error_code",conversation_uuid:n,project_uuid:i,error_code:e.errorCode,error_type:e.type,error_message:e.message}),ec((0,r.jsx)(g,{}),{error:e})):"billing_error"===e.type?ec((0,r.jsx)(x,{}),{error:e}):"overloaded_error"===e.type?ec((0,r.jsx)(k,{}),{error:e}):("invalid_request_error"===e.type&&413===e.statusCode&&T.track({event_key:"chat.conversation.token_limit_exceeded",conversation_uuid:n,project_uuid:i}),!function(e,t,n,a,i,s,o){if("exceeded_max_uploads_per_message"===e.errorCode)return o((0,r.jsx)(C,{}),{error:e}),!0;if("exceeded_max_image_limit_per_chat"===e.errorCode){let t=o((0,r.jsx)("p",{children:(0,r.jsx)(b,{numSanitizedDocuments:n,onNewChat:()=>{i({projectUuid:a}),s(t)}})}),{error:e});return!0}if("invalid_request_error"===e.type&&413===e.statusCode){let n=o((0,r.jsx)("p",{children:(0,r.jsx)(S,{numAttachmentsOrFiles:t,onNewChat:()=>{i({projectUuid:a}),s(n)}})}),{error:e});return!0}return!1}(e,t,a,i,ep,eh,ec))?"invalid_request_error"===e.type&&"read_only_mode"===e.extra.code?ec((0,r.jsx)(y,{}),{error:e}):ed(e,{errorContext:{tags:{source:"stream_completion"}}}):void 0},[i,ep,eh,ec,ed,P,n,eu,T]),ev=(0,en.useExperiment)("no_more_smoother_2"),ex=(0,er.A)(),{setCompletionStatus:ek}=(0,J.U)(n,!0),ey=(0,a.useCallback)(async e=>{let{prompt:t,attachments:r,files:a,syncSources:i,rethrowErrors:c=!1,modelOverride:d,parent_message_uuid:h,personalized_style:m,paprika_mode:p,compass_mode:_,org_type_override:f}=e;if(N)return;if(!L)throw Error("Cannot stream without an organization");let g=new AbortController;V({controller:g}),e_(null);let v=l(),x=function(e){let t={prompt:e.prompt,parent_message_uuid:e.parent_message_uuid,timezone:e.timezone,personalized_styles:e.personalized_style?[e.personalized_style]:void 0,locale:H.SC.includes(e.locale)?e.locale:H.Xn},n=(0,z.x)();return n&&(t.custom_system_prompt=n),e.model&&"string"==typeof e.model&&(t.model=e.model),e.modelOverride&&(t.model=e.modelOverride),"string"==typeof e.temperature&&(t.temperature=parseInt(e.temperature)),e.maxTokensToSample&&"string"==typeof e.maxTokensToSample&&(t.max_tokens_to_sample=parseInt(e.maxTokensToSample)),e.paprika_mode&&(t.paprika_mode=e.paprika_mode),e.compass_mode&&(t.compass_mode=e.compass_mode),e.tools.length&&(t.tools=e.tools),t}({prompt:t,parent_message_uuid:h,timezone:o.c9.local().zoneName||void 0,personalized_style:m,locale:ex.locale,model:eo,modelOverride:d,temperature:es,maxTokensToSample:el,paprika_mode:p,compass_mode:_,tools:v}),k=[],y=null,C=null,b=!0,S=null;try{let e=ev.get("no_smoothing",!1);if(ek(!0),y=(S=await (0,U.xD)({applicationType:j,endpoint:s,orgUuid:L.uuid,conversationUuid:n,body:{organization_uuid:L.uuid,conversation_uuid:n,text:t,attachments:r,files:a.map(e=>e.file_uuid),sync_sources:i.map(e=>e.uuid),..."string"==typeof f&&{org_type_override:f}},onCompletion:e=>{u(n,e),k=e},onRetry:w,abortController:g,completion:x,getTools:l,smoothingEnabled:!M&&!e})).stopReason,C=S.messageLimitResult,S&&!y)throw ei}catch(i){let e=i instanceof Z.LG;if(e_({prompt:t,attachments:r,files:a}),e&&E(i)&&(b=!1),i===ei?(u(n,k),eg(ea,r.length+a.length,a.filter(e=>"document"===e.file_kind).length),T.track({event_key:"sse_interrupted"}),(0,et.wd)("sse_interrupted"),await new Promise(e=>setTimeout(e,3e4))):(eg(i,r.length+a.length,a.filter(e=>"document"===e.file_kind).length),e||ee.v.error(ee.u.CHAT_COMPLETION,"Non-API stream error",i)),(0,et.Cp)(i,{tags:{source:e?"stream-api":"stream-generic"}}),c||(0,$.yz)())throw i}finally{await ef(C,{shouldRefetch:b}),ek(!1)}return k},[N,L,V,e_,ek,l,ex.locale,eo,es,el,ev,j,s,n,w,M,u,eg,T,ef]),eC=(0,a.useCallback)(()=>{N&&(N.controller.abort(),F())},[N,F]);return{runStream:ey,isStreaming:!!N,abortStream:eC}}function eo(e,t,n,r,i,s){let{onIncrementalCompletion:o,onStartAppend:l,onStreamCompleted:u}=(0,B.G)(r,i),c=es({conversationUuid:e,projectUuid:t,endpoint:U.ep.APPEND_MESSAGE_WITH_COMPLETION,onIncrementalCompletion:o,onStreamCompleted:u,getTools:n,onRetry:s}),{runStream:d}=c,h=(0,a.useCallback)(async t=>{let{prompt:n,attachments:r,files:a,syncSources:i,rethrowErrors:s=!1,modelOverride:o,parent_message_uuid:u,personalized_style:c,compass_mode:h,org_type_override:m}=t,p="".concat(V.EL,"-").concat((0,Q.b)()),_="".concat(V.B6,"-").concat((0,Q.b)());await l(e,e=>{if(!e)throw Error("Conversation tree must be provided for tree append");let t=(0,V.ZQ)(e),s=[{uuid:p,content:[{type:"text",text:n,citations:[]}],created_at:new Date().toISOString(),sender:"human",attachments:r,files:a,files_v2:a,sync_sources:i,index:t+1,parent_message_uuid:null!=u?u:V.gF},{uuid:_,content:[],created_at:new Date().toISOString(),sender:"assistant",attachments:[],files:[],files_v2:[],sync_sources:[],index:t+2,parent_message_uuid:p,metadata:{compass_mode:h}}];return(0,V.xQ)(e,s)}),await d({prompt:n,attachments:r,files:a,syncSources:i,rethrowErrors:s,modelOverride:o,parent_message_uuid:u,personalized_style:c,org_type_override:m})},[d,l,e]);return{...c,runStream:h}}function el(e,t,n,r,i,s,o){let{onIncrementalCompletion:l,onStreamCompleted:u,onStartAppend:c}=(0,B.G)(i,s),d=es({conversationUuid:e,projectUuid:t,endpoint:U.ep.RETRY_MESSAGE_WITH_COMPLETION,onIncrementalCompletion:l,onStreamCompleted:u,getTools:n,onRetry:o}),{runStream:h}=d,m=(0,a.useCallback)(async(t,n,a,i)=>{let s="".concat(V.B6,"-").concat((0,Q.b)());await c(e,e=>{let n=[{uuid:s,content:[],created_at:new Date().toISOString(),sender:"assistant",attachments:[],files:[],files_v2:[],sync_sources:[],parent_message_uuid:t,selectedOption:0,index:(0,V.ZQ)(e)+1}];return(0,V.xQ)(e,n)}),await h({prompt:"",attachments:[],files:[],syncSources:[],parent_message_uuid:t,personalized_style:r,paprika_mode:n,compass_mode:a,isRetry:!0,modelOverride:i})},[e,h,c,r]);return{...d,runStream:m}}},99731:(e,t,n)=>{function r(){return"undefined"!=typeof performance&&"memory"in performance&&void 0!==performance.memory}function a(){if(!r())return null;let e=performance.memory;return{usedJSHeapSize:e.usedJSHeapSize,totalJSHeapSize:e.totalJSHeapSize,jsHeapSizeLimit:e.jsHeapSizeLimit,heapUsagePercent:Math.round(e.usedJSHeapSize/e.jsHeapSizeLimit*100)}}n.d(t,{Y:()=>r,l:()=>a})}}]);