"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[370],{2722:(e,t,n)=>{n.d(t,{S:()=>p,v:()=>m});var r=n(54568),s=n(23812),i=n(84617),a=n(98304),o=n(17560),l=n(27541),u=n(39214),c=n(59666),d=n(66912);function m(e){let{isOpen:t,onClose:n,limitType:m="projects",customTitle:p,customDescription:g}=e,f=(0,l.useRouter)(),h=["opus"===m?{defaultMessage:"More Opus usage*",id:"JxRTAGj5OB"}:"message_limit"===m?{defaultMessage:"Access to tools like research and web search",id:"message_limit_benefit_tools"}:{defaultMessage:"Access to unlimited Projects to organize chats and documents",id:"uK9wA9v6Z3"},"opus"===m&&{defaultMessage:"Access to unlimited Projects to organize chats and documents",id:"uK9wA9v6Z3"},"projects"===m&&{defaultMessage:"More usage*",id:"Rve6Z5dM8k"},"message_limit"===m&&{defaultMessage:"Claude Code directly in your terminal",id:"message_limit_benefit_code"},"message_limit"===m&&{defaultMessage:"Integration to Google Workspace: email, calendar, and docs",id:"message_limit_benefit_workspace"},"message_limit"===m&&{defaultMessage:"Full access to the newest Claude models including Opus",id:"message_limit_benefit_models"},"message_limit"===m&&{defaultMessage:"Extended thinking for complex work",id:"message_limit_benefit_thinking"},"message_limit"!==m&&{defaultMessage:"Ability to search the web",id:"dl29r7OlXE"},"message_limit"!==m&&{defaultMessage:"Extended thinking for complex work",id:"mENE7vJhVQ"},"message_limit"!==m&&{defaultMessage:"Connect Google Workspace: email, calendar, and docs",id:"WwXweMd3IE"},"message_limit"!==m&&{defaultMessage:"Ability to use more Claude models",id:"Qpr1Da1f7N"}].filter(Boolean);return(0,r.jsx)(u.bL,{open:t,onOpenChange:n,children:(0,r.jsx)(u.ZL,{children:(0,r.jsx)(u.hJ,{className:"fixed inset-0 bg-always-black/50 backdrop-brightness-75 z-modal flex items-center justify-center data-[state=open]:animate-[fade_250ms_ease-in_forwards] data-[state=closed]:animate-[fade_125ms_ease-out_reverse_forwards]",children:(0,r.jsxs)(u.UC,{className:"z-modal w-full max-w-sm bg-bg-000 rounded-2xl shadow-xl overflow-hidden focus:outline-none data-[state=open]:animate-[zoom_250ms_ease-in_forwards] data-[state=closed]:animate-[zoom_125ms_ease-out_reverse_forwards]",onEscapeKeyDown:e=>{e.preventDefault(),n()},onInteractOutside:e=>{e.preventDefault(),n()},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-5 pt-4",children:[(0,r.jsx)(d.M,{}),(0,r.jsx)(u.bm,{asChild:!0,children:(0,r.jsx)(s.$,{variant:"ghost",size:"icon_sm",className:"text-text-400 hover:text-text-200",children:(0,r.jsx)(a.X,{size:20,weight:"regular"})})})]}),(0,r.jsxs)("div",{className:"px-5 pb-4 pt-2",children:[(0,r.jsx)("h2",{className:"text-[24px] leading-tight font-medium mb-2 text-text-000",children:p||("opus"===m?(0,r.jsx)(c.A,{defaultMessage:"More Opus with Pro and Max plans",id:"//ixi/rP/O"}):"message_limit"===m?(0,r.jsx)(c.A,{defaultMessage:"Keep chatting with Claude",id:"u3sKHTmxou"}):(0,r.jsx)(c.A,{defaultMessage:"Unlimited projects with Pro and Max plans",id:"RKBJDiWP1p"}))}),(0,r.jsx)("p",{className:"".concat("message_limit"===m?"text-sm":"text-base"," text-text-300 mb-3"),children:g||("opus"===m?(0,r.jsx)(c.A,{defaultMessage:"Free plans only get 3 Opus messages per week. Try again after {date}, or upgrade now to get:",id:"IIJcLbtXZK",values:{date:new Date(Date.now()+6048e5).toLocaleDateString("en-US",{month:"long",day:"numeric"})}}):"message_limit"===m?(0,r.jsx)(c.A,{defaultMessage:"You just hit your free message limit. Upgrade to Pro (or Max) to send more messages. You also get:",id:"vXAAoQRvRg"}):(0,r.jsx)(c.A,{defaultMessage:"Free plans only get access to one Project. Upgrade now to get:",id:"NOiyw9Bber"}))}),(0,r.jsx)("div",{className:"space-y-1.5 mb-6",children:h.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-start gap-2.5",children:[(0,r.jsx)(o.J,{className:"text-text-400 mt-0.5 flex-shrink-0",size:18,weight:"regular"}),(0,r.jsx)("span",{className:"text-sm text-text-200",children:(0,r.jsx)(c.A,{...e})})]},"benefit-".concat(t)))}),("opus"===m||"projects"===m)&&(0,r.jsx)("p",{className:"text-xs text-text-400 mb-4",children:(0,r.jsx)(i.Y,{href:"https://support.anthropic.com/en/articles/11049762-choosing-a-claude-ai-plan",target:"_blank",rel:"noopener noreferrer",children:(0,r.jsx)(c.A,{defaultMessage:"*Usage limits apply",id:"HFRZOFWXCf"})})}),(0,r.jsx)(s.$,{variant:"primary",size:"lg",className:"w-full text-base font-medium",onClick:()=>{n(),f.push("/upgrade")},children:(0,r.jsx)(c.A,{defaultMessage:"See plans",id:"vbFKkTYpN+"})})]})]})})})})}let p=m},4114:(e,t,n)=>{n.d(t,{p:()=>a});var r=n(18088),s=n(68067),i=n(56706);let a=()=>{let e=(0,s.fS)("concise_mode_enabled"),{data:t,isLoading:n}=(0,i.O5)(),a=(null==t?void 0:t.defaultStyles)||[],o=[...a,...((null==t?void 0:t.customStyles)||[]).map(e=>({...e,key:e.key||e.uuid}))],[l,u,c]=(0,r.Vc)("claude_personalized_style",null);if(n||!(null==o?void 0:o.length))return{personalizedStyleOptions:[],defaultStyle:null,storedStyle:null,setStoredStyle:u,clearStoredStyle:c,conciseModeEnabled:e};let d=a.length?a.find(e=>!0===e.isDefault)||a[0]:null;if(e&&(d=a.find(e=>"Concise"===e.key)||d),!l)return{personalizedStyleOptions:o,defaultStyle:d,storedStyle:l,setStoredStyle:u,clearStoredStyle:c,conciseModeEnabled:e};let m=o.find(e=>((e,t)=>"default"===e.type&&e.key===t||"custom"===e.type&&e.uuid===t)(e,l.styleKey)),p=Date.now()-new Date(l.timestamp).getTime()>432e5;return{personalizedStyleOptions:o,storedStyle:m&&!p?m:null,defaultStyle:d,setStoredStyle:u,clearStoredStyle:c,conciseModeEnabled:e}}},13296:(e,t,n)=>{n.d(t,{ul:()=>a});let r={};class s{clear(){}getItem(e){return null}key(e){return null}removeItem(e){}setItem(e,t){}constructor(){this.length=0}}let i=new s,a=()=>(()=>{if(!window.localStorage)return!1;if(void 0===r.localStorageSupported){let e=!!("localStorage"in window&&window.localStorage);if(e)try{localStorage.setItem("test.localStorageSupported","true")}catch(t){e=!1}r.localStorageSupported=e}return r.localStorageSupported})()?window.localStorage:i},27125:(e,t,n)=>{n.d(t,{TA:()=>c,_x:()=>u,eI:()=>l,p9:()=>o});var r=n(39613),s=n(13296);let i="enabled",a="".concat(r.sn,".statsig.");function o(e){return"".concat(a).concat(e)}function l(e,t,n,r){let a=o(e);(null!=r?r:t(e,n))?(0,s.ul)().setItem(a,i):(0,s.ul)().setItem(a,"disabled")}function u(e,t,n){let r=o(e);if((0,s.ul)().getItem(r)===i)return!0;let a=t(e,n);return l(e,t,n,a),a}function c(e,t){if(t)for(let n of Object.keys((0,s.ul)()).filter(e=>e.startsWith(a)).map(e=>e.replace(a,"")))l(n,e,t,e(n,t))}},52135:(e,t,n)=>{n.d(t,{F:()=>l});var r=n(68067),s=n(27736),i=n(7620),a=n(96614),o=n(86545);let l=()=>{let e="sticky-model-selector",t=(0,r.fS)("sticky_model_selector"),n=(0,r.fS)("model_selector_enabled"),{activeModelOptions:l}=(0,o.A9)(),u=(0,a.Z3)(null),c=(0,s.useQuery)({queryKey:[e],queryFn:()=>{if(!t||!n)return null;let r=localStorage.getItem(e);return r===u?null:r&&l.find(e=>e.model===r)?r:null},initialData:null}),d=(0,i.useCallback)(t=>{t&&localStorage.setItem(e,t),c.refetch()},[c]);return{stickyModelPreference:c.data,setStickyModelPreference:d}}},55188:(e,t,n)=>{n.d(t,{S:()=>m,r:()=>p});var r=n(54568),s=n(74813),i=n(39613),a=n(99969),o=n.n(a),l=n(27541),u=n(7620),c=n(24443);let d=u.createContext({incognitoModeEnabled:!1,setIncognitoModeEnabled:o(),temporaryConversationUuid:null,setTemporaryConversationUuid:o()}),m=()=>u.useContext(d),p=e=>{let{children:t}=e,n=(0,s.st)(),a=(0,l.useRouter)(),o=(0,l.useSearchParams)(),m=(0,c.I_)(),p=o.has(i.cn),[g,f]=(0,u.useState)(p),h=(0,u.useRef)(g),[v,y]=(0,u.useState)(null);(0,u.useEffect)(()=>{h.current=g},[g]),(0,u.useEffect)(()=>{p&&!g&&f(!0)},[p,g]);let b=(0,u.useCallback)(e=>{if(f(e),e)a.push("?".concat(i.cn));else{y(null);let e=new URLSearchParams(o.toString());e.delete(i.cn);let t=e.toString();a.push("".concat(window.location.pathname).concat(t?"?".concat(t):""),void 0)}n.track({event_key:"claudeai.incognito_mode.toggled",enabled:e})},[a,o,n]);(0,u.useEffect)(()=>{h.current&&!p&&b(!1)},[b,p]);let _=(0,u.useMemo)(()=>({incognitoModeEnabled:!!m&&g,setIncognitoModeEnabled:b,temporaryConversationUuid:m?v:null,setTemporaryConversationUuid:y}),[g,b,v,y,m]);return(0,r.jsx)(d.Provider,{value:_,children:t})}},55442:(e,t,n)=>{n.d(t,{PerformanceMetricsProvider:()=>S,B:()=>k});var r=n(54568),s=n(73356);class i extends Error{}class a{add(e){this.buffer[this.head]=e,this.head=(this.head+1)%this.maxSize,this.currentSize<this.maxSize&&this.currentSize++}addAll(e){for(let t of e)this.add(t)}flush(){this.head=0,this.currentSize=0,this.buffer=Array(this.maxSize)}get size(){return this.currentSize}get isEmpty(){return 0===this.currentSize}get isFull(){return this.currentSize===this.maxSize}*values(){if(0===this.currentSize)return;let e=this.isFull?this.head:0;for(let t=0;t<this.currentSize;t++){let n=(e+t)%this.maxSize;yield this.buffer[n]}}toArray(){return Array.from(this.values())}getLast(){if(0===this.currentSize)return;let e=(this.head-1+this.maxSize)%this.maxSize;return this.buffer[e]}getFirst(){if(0===this.currentSize)return;let e=this.isFull?this.head:0;return this.buffer[e]}constructor(e){if(this.maxSize=e,this.head=0,this.currentSize=0,e<1)throw new i("RingBuffer maxSize must be 1 or more");this.buffer=Array(e)}}var o=n(99731),l=n(42248);class u{get mean(){return this.count>0?this._mean:0}get variance(){return this.count>1?this._m2/(this.count-1):0}get stdDev(){return Math.sqrt(this.variance)}calculate(){let e=this._tail-this._mean;this._mean+=e/this.count;let t=this._tail-this._mean;this._m2+=e*t}getSummary(){return{count:this.count,sum:this.sum,min:this.min,max:this.max,mean:this.mean,variance:this.variance,stdDev:this.stdDev}}reset(){this.count=0,this.sum=0,this.min=1/0,this.max=-1/0,this._mean=0,this._m2=0}add(e){this.count+=1,this.sum+=e,this.min=Math.min(this.min,e),this.max=Math.max(this.max,e),this._tail=e,this.calculate()}constructor(){this.count=0,this.sum=0,this.min=1/0,this.max=-1/0,this._tail=0,this._mean=0,this._m2=0,this.reset()}}class c{init(){if(this.shouldReportMemory=(0,o.Y)(),"PerformanceLongTaskTiming"in window)try{this.events.longTask.observer=this.initLongTaskObserver()}catch(e){s.v.error(s.u.O11Y_INTERNALS,"PerfMon LongTaskObserver failed to init")}if("PerformanceEventTiming"in window)try{this.events.inputDelay.observer=this.initInputDelayObserver()}catch(e){s.v.error(s.u.O11Y_INTERNALS,"PerfMon EventTimingObserver failed to init")}if("PerformanceLongAnimationFrameTiming"in window)try{this.events.longAnimationFrame.observer=this.initLongAnimationFrameObserver()}catch(e){s.v.error(s.u.O11Y_INTERNALS,"PerfMon EventTimingObserver failed to init")}this.startReportMetricsInterval(),this.registerVisibilityHandlers()}initLongTaskObserver(){let e=new PerformanceObserver(e=>{for(let n of e.getEntries()){let{attribution:e}=n;if(this.events.longTask.stats.add(n.duration),n.duration>=250){var t;this.events.longTask.buffer.add({start_time:n.startTime,duration_ms:n.duration,attribution_count:null!=(t=null==e?void 0:e.length)?t:0})}}});return e.observe({entryTypes:["longtask"]}),e}initInputDelayObserver(){let e=new PerformanceObserver(e=>{for(let n of e.getEntries()){let e=n.processingStart?n.processingStart-n.startTime:0;if(e>100){this.events.inputDelay.stats.add(n.duration);let r=Number(n.processingEnd)-Number(n.processingStart);if(e>250||r>250){var t;this.events.inputDelay.buffer.add({start_time:n.startTime,duration_ms:e,processing_duration_ms:r,inp_duration_ms:n.duration,event_name:n.name,event_target_id:(null==(t=n.target)?void 0:t.id)||"unknown_target",is_fid:"first-input"===n.entryType})}}}});return e.observe({entryTypes:["event","first-input"]}),e}initLongAnimationFrameObserver(){let e=new PerformanceObserver(e=>{for(let t of e.getEntries()){let{blockingDuration:e}=t;if(this.events.longAnimationFrame.stats.add(t.duration),t.duration>=250){let n={start_time:t.startTime,duration_ms:t.duration,blocking_duration_ms:e||0};this.events.longAnimationFrame.buffer.add(n)}}});return e.observe({entryTypes:["long-animation-frame"]}),e}startReportMetricsInterval(){let e=()=>{this.reportMetricsTimeoutId=window.setTimeout(()=>{this.reportMetrics(),this.isActive&&e()},12e4)};e()}registerVisibilityHandlers(){document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&this.reportMetrics()},{passive:!0}),window.addEventListener("pagehide",()=>this.reportMetrics(),{passive:!0})}reportMetrics(){this.isActive&&(this.shouldReportMemory&&(0,l.r)("events.memory_snapshot",{metricType:"memory_snapshot"}),Object.values(this.events).forEach(e=>{let{name:t,stats:n,buffer:r}=e;0!==n.mean&&((0,l.r)("events.".concat(t,".summary"),{metricType:"".concat(t,"_summary"),performanceAttributes:{...n.getSummary()}}),r.toArray().forEach(e=>{let{duration_ms:n,...r}=e;(0,l.r)("events.".concat(t),{metricType:"".concat(t,"_event"),duration:n,performanceAttributes:{...r}})}),n.reset(),r.flush())}))}destroy(){this.isActive=!1,Object.values(this.events).forEach(e=>{var t;null==(t=e.observer)||t.disconnect(),e.observer=void 0}),clearTimeout(this.reportMetricsTimeoutId),this.reportMetricsTimeoutId=void 0,this.reportMetrics()}forceReport(){this.reportMetrics()}constructor(){this.isActive=!0,this.shouldReportMemory=!1,this.events={longTask:{name:"long_task",stats:new u,buffer:new a(100)},inputDelay:{name:"input_delay",stats:new u,buffer:new a(100)},longAnimationFrame:{name:"loaf",stats:new u,buffer:new a(100)}},this.init()}}var d=n(24024);class m{initPerfMon(){this.perfMon||(this.perfMon=new c)}trackNewChatInputReady(e){(0,l.r)("page.new_chat_input_ready",{duration:e.duration,attributes:{is_first_load:e.isFirstLoad,is_prog_chat_input:e.isProgChatInput,prog_chat_input_perf_mark_missing:e.progChatInputPerfMarkMissing}}),d.C.clearParentContext()}trackTTFT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};t.model&&(n["chat.model"]=t.model),t.integrations&&(n["chat.integrations"]=t.integrations),(0,l.r)("chat.time_to_first_token",{metricType:"ttft",duration:e,attributes:n})}trackProjectConversationsReady(e){(0,l.r)("page.project_conversations_ready",{duration:e})}trackMembersListReady(e){(0,l.r)("page.members_list_ready",{duration:e})}constructor(){this.perfMon=null}}let p=new m;var g=n(13296),f=n(27541),h=n(7620),v=n(27125);let y="prog_chat_input_ready",b=(0,v.p9)("prog_chat_input"),_=(0,h.createContext)(null);function S(e){let{children:t}=e,n=(0,f.usePathname)(),s=(0,h.useRef)(!0),i=(0,h.useRef)(null),a=(0,h.useRef)(!1),o=(0,h.useRef)(null),l=(0,h.useRef)(!1),u=(0,h.useRef)(null),c=(0,h.useRef)(!1),d=(0,h.useRef)(null),m=(0,h.useRef)(!1);(0,h.useEffect)(()=>{p.initPerfMon()},[]),(0,h.useEffect)(()=>{"/new"===n?(i.current=s.current?0:performance.now(),a.current=!1):(null==n?void 0:n.startsWith("/project/"))?(u.current=performance.now(),c.current=!1):"/settings/members"===n&&(d.current=performance.now(),m.current=!1),s.current=!1},[n]);let v=(0,h.useCallback)(()=>{if(a.current||null===i.current)return;a.current=!0;let e=0===i.current,{duration:t,isProgChatInput:n,progChatInputPerfMarkMissing:r}=function(e,t){let n,r=performance.getEntriesByName(y,"mark")[0],s="enabled"===(0,g.ul)().getItem(b),i=!1;return r&&t?(n=r.startTime,performance.clearMarks(y)):(n=performance.now()-e,s&&t&&(i=!0)),{duration:n,isProgChatInput:s,progChatInputPerfMarkMissing:i}}(i.current,e);p.trackNewChatInputReady({duration:t,isFirstLoad:e,isProgChatInput:n,progChatInputPerfMarkMissing:r}),i.current=null},[]),S=(0,h.useCallback)(()=>{o.current=performance.now(),l.current=!1},[]),k=(0,h.useCallback)(e=>{if(null===o.current||l.current)return;l.current=!0;let t=performance.now()-o.current;p.trackTTFT(t,e),o.current=null},[]),x=(0,h.useCallback)(()=>{if(c.current||null===u.current)return;c.current=!0;let e=performance.now()-u.current;p.trackProjectConversationsReady(e),u.current=null},[]),w=(0,h.useCallback)(()=>{if(m.current||null===d.current)return;m.current=!0;let e=performance.now()-d.current;p.trackMembersListReady(e),d.current=null},[]),C=(0,h.useMemo)(()=>({markEditorReady:v,markMessageSent:S,markFirstTokenReceived:k,markProjectConversationsReady:x,markMembersListReady:w}),[v,S,k,x,w]);return(0,r.jsx)(_.Provider,{value:C,children:t})}function k(){let e=(0,h.useContext)(_);if(!e)throw Error("usePerformanceMetrics must be used within a PerformanceMetricsProvider");return e}},56706:(e,t,n)=>{n.d(t,{M$:()=>c,O5:()=>o,f$:()=>l,lo:()=>u,n7:()=>d});var r=n(1613),s=n(64328),i=n(80688),a=n(4869);let o=()=>{let{activeOrganization:e}=(0,s.YL)(),t=null==e?void 0:e.uuid;return(0,r.Sk)("/api/organizations/".concat(t,"/list_styles"),{queryKey:[i.ss,{orgUuid:t}]})},l=()=>{let{activeOrganization:e}=(0,s.YL)(),t=null==e?void 0:e.uuid,n=(0,a.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(t,"/styles/create"),"POST",{onSuccess:()=>{n.invalidateQueries({queryKey:[i.ss,{orgUuid:t}]})}})},u=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{activeOrganization:n}=(0,s.YL)(),o=null==n?void 0:n.uuid,l=(0,a.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(o,"/styles/").concat(e,"/edit"),"PUT",{onSuccess:()=>{l.invalidateQueries({queryKey:[i.ss,{orgUuid:o}]})},enabled:!t})},c=e=>{let{activeOrganization:t}=(0,s.YL)(),n=null==t?void 0:t.uuid,o=(0,a.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(n,"/styles/").concat(e,"/delete"),"DELETE",{onSuccess:()=>{o.invalidateQueries({queryKey:[i.ss,{orgUuid:n}]})}})},d=()=>{let{activeOrganization:e}=(0,s.YL)(),t=null==e?void 0:e.uuid;return(0,r.L2)("/api/organizations/".concat(t,"/styles/preview"),"POST")}},59074:(e,t,n)=>{n.d(t,{OpusRateLimitModalProvider:()=>l,T:()=>o});var r=n(54568),s=n(7620),i=n(2722);let a=null;function o(){a&&a(!0)}function l(){let[e,t]=(0,s.useState)(!1);return(0,s.useEffect)(()=>(a=t,()=>{a=null}),[]),(0,r.jsx)(i.v,{isOpen:e,onClose:()=>t(!1),limitType:"opus"})}},66912:(e,t,n)=>{n.d(t,{M:()=>a});var r=n(54568),s=n(72902),i=n(59666);function a(e){let{className:t,onClick:n,as:a="span"}=e;return(0,r.jsx)(a,{className:(0,s.A)("border-0.5 border-border-400 text-accent-secondary-000 px-1.5 py-px rounded-3xl font-small",n&&"cursor-pointer hover:border-border-300 transition-colors",t),onClick:n,children:(0,r.jsx)(i.A,{defaultMessage:"Upgrade",id:"0h/lPMeYkq"})})}},86141:(e,t,n)=>{n.d(t,{EF:()=>p,NY:()=>d,Ql:()=>f,VA:()=>g,qJ:()=>m});var r=n(1613),s=n(64328);n(39613);var i=n(80688),a=n(2e3),o=n(4869),l=n(7620),u=n(22167),c=n(91958);let d=e=>{let{activeOrganization:t}=(0,s.YL)(),n=null==t?void 0:t.uuid,a=!!(t&&e.length>0),o=(0,l.useMemo)(()=>e.map(e=>"/api/organizations/".concat(n,"/sync/chat/").concat(e)),[n,e]),c=(0,l.useMemo)(()=>({queryKey:e.map(e=>[i.GC,{orgUuid:n,syncSourceUuid:e}]),enabled:a,refetchInterval:e=>!!(e.state.data&&(0,u.z3)(e.state.data))&&5e3,meta:{noToast:!0}}),[a,n,e]);return(0,r._i)(o,c)},m=e=>!!e.some(e=>e.isLoading)||e.some(e=>e.data&&(0,u.z3)(e.data)),p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:t,activeOrganization:n}=(0,s.YL)(),l=null==t?void 0:t.uuid,d=null==n?void 0:n.uuid,m=(0,o.useQueryClient)(),p=(0,u.eL)();return(0,r.L2)(()=>"/api/organizations/".concat(d,"/sync/chat"),"POST",{enabled:!!n,...e,onSuccess:function(){for(var t,n,r,s,o,u=arguments.length,c=Array(u),p=0;p<u;p++)c[p]=arguments[p];let[g]=c;m.setQueryData([i.GC,{orgUuid:d,syncSourceUuid:g.uuid}],g),g.type===a.v8.GDRIVE&&g.config.uri&&(null==(t=g.status)?void 0:t.extra)&&(null==(n=g.status)?void 0:n.current_size_bytes)&&m.setQueryData([i.QB,{accountUuid:l,orgUuid:d,documentId:g.config.uri}],{uri:"drive:///".concat(g.config.uri),title:null==(s=g.status)?void 0:s.extra,size:null==(o=g.status)?void 0:o.current_size_bytes}),null==(r=e.onSuccess)||r.call(e,...c)},onError:function(){for(var t,n=arguments.length,r=Array(n),s=0;s<n;s++)r[s]=arguments[s];null==(t=e.onError)||t.call(e,...r);let[i,o]=r;p(i,o),o.sync_source_type===a.v8.GDRIVE&&(0,c.D8)(o.sync_source_config.uri)}})},g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,s.YL)(),n=null==t?void 0:t.uuid,a=(0,o.useQueryClient)();return(0,r.L2)(()=>"/api/organizations/".concat(n,"/sync/chat"),"PUT",{enabled:!!t,...e,onSuccess:function(){for(var t,r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];let[l]=s;a.setQueryData([i.GC,{orgUuid:n,syncSourceUuid:l.uuid}],l),null==(t=e.onSuccess)||t.call(e,...s)}})},f=()=>{let{activeOrganization:e}=(0,s.YL)(),t=null==e?void 0:e.uuid;return(0,r.L2)(e=>"/api/organizations/".concat(t,"/sync/chat/").concat(e),"DELETE",{enabled:!!e})}},90370:(e,t,n)=>{n.d(t,{_A:()=>O,oM:()=>z});var r=n(54568),s=n(76737),i=n(96769),a=n(44894),o=n(3971),l=n(52135),u=n(34003),c=n(74813),d=n(1613),m=n(16178),p=n(7620),g=n(4211),f=n(42469),h=n(86141),v=n(94028),y=n(24443),b=n(93714),_=n(45538),S=n(64328),k=n(35984),x=n(10665),w=n(4114),C=n(59074),M=n(55442),P=n(54667),E=n(35580),T=n(55188),j=n(88775),I=n(68067);let A=p.createContext({transitionFiles:[],isAtMaxNumUploads:!1,model:"",isChatSyncing:!1,personalizedStyle:void 0,isProjectSyncing:!1,isNewConversation:!1,isProjectLocked:!1,isSending:!1,setModel:()=>Promise.resolve(),setProjectUuid:()=>void 0,sendMessage:()=>void 0,sendTransparentMessage:()=>void 0,stopSampling:()=>void 0,pendingConversationSettings:{},conversation:void 0,focusInput:()=>void 0,improvePrompt:()=>void 0,isImprovingPrompt:!1,promptInputRef:{current:null},willRedirectOnSubmit:!1,hasBlockingWarning:!1,setHasBlockingWarning:()=>void 0,setPersonalizedStyle:()=>void 0,isUploadingDriveSync:!1,isUploadingGithubSync:!1,setIsUploadingDriveSync:()=>void 0,setIsUploadingGithubSync:()=>void 0,includeProfilePreferences:!0,setIncludeProfilePreferences:()=>void 0,isUploadingFile:!1,setIsUploadingFile:()=>void 0,validateMaxUploadLimit:()=>!1,onDrop:()=>void 0,onPasteFiles:()=>Promise.resolve(),handleUpload:()=>Promise.resolve(),uploadInputProps:{type:"",accept:"",onChange:()=>void 0,multiple:!1,"aria-label":""},hasAttachments:!1,isModelSelectorOpen:!1,setIsModelSelectorOpen:()=>void 0,setPendingConversationSettings:()=>void 0,currentCompassTask:void 0,setCurrentCompassTask:()=>void 0,dynamicAction:()=>void 0}),z=()=>p.useContext(A),O=e=>{var t,n,z,O,U,L,R;let{onSend:N,willRedirectOnSubmit:D,onCreate:F,onSessionCreate:Y,onStopSampling:G,children:K,chatType:Q}=e,B="conversation"in e,W=B?e.conversation:void 0,q="projectUuid"in e?e.projectUuid:void 0,J=null!=(n=null==W?void 0:W.id)?n:void 0===q?"new-conversation":"".concat(q,":conversation"),H=(0,I.fS)("v2_prompt_storage"),{store:V,unsubscribe:X}=(0,p.useMemo)(()=>(0,P.E)({enableV2:H,conversationId:J}),[J,H]);(0,p.useEffect)(()=>()=>{null==X||X()},[X]);let{incognitoModeEnabled:Z}=(0,T.S)(),$=(0,p.useRef)(null),{track:ee}=(0,c.st)();(0,p.useEffect)(()=>{(0,V.getState().setPromptInputRef)($)},[V]);let{markMessageSent:et}=(0,M.B)(),en=(0,p.useCallback)(()=>{B&&G&&G()},[G,B]);(e=>{let t=(0,p.useCallback)(t=>{if(e&&!(e=>!!e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||"true"===e.getAttribute("contenteditable")||"textbox"===e.getAttribute("role")))(document.activeElement)&&1===t.key.length&&!t.ctrlKey&&!t.altKey&&!t.metaKey){var n;if(!(" "===t.key&&(e=>{if(!e)return!1;let t=e.tagName;return"BUTTON"===t||"SUMMARY"===t||"SELECT"===t||("INPUT"===t?["button","submit","reset","checkbox","radio"].includes(e.type):["button","checkbox","radio","switch","menuitem","menuitemcheckbox","menuitemradio","option"].includes(e.getAttribute("role")||""))})(document.activeElement)))t.preventDefault(),null==(n=e.getEditor())||n.chain().insertContent(t.key).focus().run()}},[e]);(0,p.useEffect)(()=>(document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)),[t])})($.current);let{attachments:er,files:es,syncSourceUuids:ei}=(0,g.P)(V,(0,f.k)(e=>({attachments:e.attachments,files:e.files,syncSourceUuids:e.syncSourceUuids}))),{setAttachments:ea,setFiles:eo,setSyncSourceUuids:el}=(0,p.useMemo)(()=>{let e=V.getState();return{setAttachments:e.setAttachments,setFiles:e.setFiles,setSyncSourceUuids:e.setSyncSourceUuids}},[V]),eu=(0,h.NY)(ei),ec=(0,h.qJ)(eu),ed=(0,d.B7)(eu),em=er.length+es.length+ei.length>=a.XA.maxTotalUploadsPerMessage,{isModelSelectorOpen:ep,isSending:eg,isUploadingDriveSync:ef,isUploadingGithubSync:eh,personalizedStyle:ev,includeProfilePreferences:ey,currentCompassTask:eb}=(0,g.P)(V,(0,f.k)(e=>({isModelSelectorOpen:e.isModelSelectorOpen,isSending:e.isSending,isUploadingDriveSync:e.isUploadingDriveSync,isUploadingGithubSync:e.isUploadingGithubSync,personalizedStyle:e.personalizedStyle,includeProfilePreferences:e.includeProfilePreferences,currentCompassTask:e.currentCompassTask}))),{setIsModelSelectorOpen:e_,setIsSending:eS,setIsUploadingDriveSync:ek,setIsUploadingGithubSync:ex,setPersonalizedStyle:ew,setIncludeProfilePreferences:eC,setCurrentCompassTask:eM,setStoreModel:eP,setStoreConversation:eE,setStorePendingConversationSettings:eT,_setProjectUuid:ej}=(0,p.useMemo)(()=>{let e=V.getState();return{setIsModelSelectorOpen:e.setIsModelSelectorOpen,setIsSending:e.setIsSending,setIsUploadingDriveSync:e.setIsUploadingDriveSync,setIsUploadingGithubSync:e.setIsUploadingGithubSync,setPersonalizedStyle:e.setPersonalizedStyle,setIncludeProfilePreferences:e.setIncludeProfilePreferences,setCurrentCompassTask:e.setCurrentCompassTask,setStoreModel:e.setModel,setStoreConversation:e.setConversation,setStorePendingConversationSettings:e.setPendingConversationSettings,_setProjectUuid:e.setProjectUuid}},[V]),[eI,eA]=p.useState(),{stickyModelPreference:ez}=(0,l.F)(),eO=null!=(U=null!=(O=null!=(z=null==W?void 0:W.model)?z:eI)?O:ez)?U:void 0,eU=(0,x.vP)("enabled_mcp_tools"),eL=(0,p.useRef)(eU);eL.current=eU;let[eR,eN]=p.useState(),eD=(0,p.useMemo)(()=>({}),[]);(0,p.useLayoutEffect)(()=>{let e=V.getState();e.model!==eO&&eP(eO),e.conversation!==W&&eE(W);let t=null!=eR?eR:eD,n=e.pendingConversationSettings,r=!n||0===Object.keys(n).length,s=!eR||0===Object.keys(eR).length;r&&s||n===t||eT(t)},[V,W,eO,eR,eD,eP,eE,eT]);let eF=(0,p.useCallback)(e=>{eN(t=>{let n={...t,...e};return eT(n),n})},[eT]);(0,p.useEffect)(()=>{"yukon_gold"===Q&&eF({enabled_yukon_gold:!0})},[Q,eF]);let eY=(0,g.P)(V,e=>e.projectUuid),eG=(0,y.Ah)(),eK=(0,_.kj)(),{mutate:eQ}=(0,_.my)(),{mutate:eB}=(0,v.nI)(),eW=(0,p.useCallback)(e=>{ej(e),eK?e&&eQ&&eQ({projectUuid:e}):eG&&e&&eB&&eB({project_uuid:e})},[eG,eQ,eB,ej,eK]),eq=(0,b.ks)(eY),[eJ,eH]=p.useState(),{storedStyle:eV,defaultStyle:eX}=(0,w.p)();(0,p.useEffect)(()=>{let e=null!=eV?eV:eX;!ev&&e&&ew(e)},[eV,eX,ev,ew]);let eZ=(0,p.useRef)(q);(0,p.useEffect)(()=>{(eZ.current!==q||void 0===eY&&void 0!==q)&&(eY!==q&&eW(q),eZ.current=q)},[q,eY,eW]);let e$="setPersonalizedStyleCallback"in e?e.setPersonalizedStyleCallback:null,e0=null==W?void 0:W.id;(0,p.useEffect)(()=>{eH(void 0),eS(!1)},[e0,eS]),(0,p.useEffect)(()=>{null==e$||e$(ev)},[ev,e$]);let e1=(0,p.useCallback)(async()=>{let e=V.getState().getPrompt();if(!$.current||""===e.trim()&&0===er.length&&0===es.length&&0===ei.length)return;let t=V.getState().tipTapEditorState,n=(0,o.Oe)(t),{multipleNewlineCount:r,singleNewlineCount:s}=(0,i.Dn)(e);D&&eH([...es]),V.getState().clearAllInput(),V.getState().setPrompt("",{forceUpdateTiptap:!1}),D?$.current.setEditable(!1):$.current.setContent(""),eS(!0);try{if(et(),ee({event_key:"claudeai.message.sent",conversation_uuid:J,model:eO,has_attachments:er.length>0,has_files:es.length>0,has_sync_sources:ei.length>0,message_length:e.length,is_new_conversation:!B,has_personalized_style:!!ev,include_profile_preferences:ey,is_incognito:Z,text_formatting:n,multiple_newline_count:r,single_newline_count:s}),B&&N)await N({prompt:e,attachments:er,files:es,syncSources:ed,personalized_style:ev}),eS(!1),eH(void 0);else if(V.getState().pendingConversationSettings.enabled_yukon_gold&&Y){var a,l;let t=(l=null!=(a=eL.current)?a:{},Object.fromEntries(Array.from(new Set((0,E._b)(!1,l).filter(e=>"mcp_server_uuid"in e).map(e=>e.mcp_server_uuid))).map(e=>(0,E.et)(e)).filter(Boolean).filter(e=>(0,E.pH)(e.uuid)).map(e=>[e.uuid,{type:"http",url:e.url,headers:{"X-MCP-Server-ID":e.uuid}}])));await Y(e,t)}else{let t=V.getState().pendingConversationSettings;await F({prompt:e,attachments:er,files:es,syncSources:ed,model:eO,project_uuid:eY,personalized_style:ev,include_conversation_preferences:ey,is_temporary:Z,...t})}}catch(t){if(V.getState().setPrompt(e,{forceUpdateTiptap:!0}),ea(er),eo(es),el(ei),$.current.setEditable(!0),eS(!1),eH(void 0),t instanceof m.LG&&"opus_messages_rate_limit_exceeded"===t.errorCode)(0,C.T)();else throw t}},[V,J,er,es,ei,D,eS,et,ee,eO,ey,Z,ev,B,N,Y,ed,F,eY,ea,eo,el]),e2=(0,p.useCallback)(async e=>{if(void 0!==e&&""!==e.trim()&&B){eS(!0);try{N&&(await N({prompt:e,attachments:[],files:[],syncSources:[],personalized_style:ev}),eS(!1))}catch(e){if(e instanceof m.LG&&"opus_messages_rate_limit_exceeded"===e.errorCode)(0,C.T)();else throw e;eS(!1)}}},[B,N,ev,eS]),{streamImprovement:e6,isStreaming:e5}=function(){let{activeOrganization:e}=(0,S.YL)(),[t,n]=(0,p.useState)(!1),[r,s]=(0,p.useState)(null),i=(0,p.useRef)(null),{addError:a}=(0,k.Y)(),o=(0,p.useCallback)(async(t,r,o,l)=>{i.current&&i.current.abort();let u=new AbortController;i.current=u,n(!0),s(null);let c="/api/organizations/".concat(null==e?void 0:e.uuid,"/prompt/improve/stream");try{var d,m,p;let e=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include",signal:u.signal});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let n=null==(d=e.body)?void 0:d.getReader(),s=new TextDecoder;if(!n)throw Error("No response body");let i="",a="",l=!1;for(;!l;){let e=await n.read();if(e.done){l=!0;break}let t=e.value,u=(i+=s.decode(t,{stream:!0})).split("\n");for(let e of(i=u.pop()||"",u))if(e.startsWith("data: ")){let t=e.slice(6);if("[DONE]"===t)continue;try{let e=JSON.parse(t);switch(e.type){case"content_block_delta":(null==(m=e.delta)?void 0:m.text)&&(a+=e.delta.text,r(e.delta.text));break;case"message_stop":o(e.improved_prompt||a);break;case"error":throw Error((null==(p=e.error)?void 0:p.message)||"Unknown error occurred")}}catch(e){}}else e.startsWith("event: ")&&e.slice(7)}}catch(t){if(t instanceof Error&&"AbortError"===t.name)return;let e=t instanceof Error?t:Error(String(t));s(e),null==l||l(e),a("Failed to improve prompt.",{error:e})}finally{n(!1),i.current===u&&(i.current=null)}},[null==e?void 0:e.uuid,a]);return(0,p.useEffect)(()=>()=>{i.current&&i.current.abort()},[]),{streamImprovement:o,isStreaming:t,error:r}}(),e4=(0,p.useCallback)(async()=>{var e,t,n,r;let s=V.getState().getPrompt();if(!s.trim())return;null==(e=$.current)||e.setEditable(!1);let i="",a=!1;try{await e6({conversation_uuid:(null==W?void 0:W.id)||"new-conversation",prompt:s},e=>{var t,n,r;a||(a=!0,V.getState().setPrompt(""),null==(r=$.current)||r.setContent("")),i+=e,V.getState().setPrompt(i,{forceUpdateTiptap:!1}),null==(t=$.current)||t.setContent(i),null==(n=$.current)||n.scrollToEnd()},e=>{var t;V.getState().setPrompt(e),null==(t=$.current)||t.setContent(e)},e=>{var t;V.getState().setPrompt(s),null==(t=$.current)||t.setContent(s)})}catch(e){V.getState().setPrompt(s),null==(t=$.current)||t.setContent(s)}finally{null==(n=$.current)||n.setEditable(!0),null==(r=$.current)||r.focus()}},[V,e6,null==W?void 0:W.id]),e3=(0,p.useCallback)(async e=>{let t=V.getState().getPrompt();if(eA(e),eP(e),B){eS(!0);try{var n;await F({prompt:t,attachments:er,files:es,syncSources:ed,model:e,project_uuid:eY,create_mode:null==W||null==(n=W.conversationSettings)?void 0:n.create_mode,...eR})}finally{eS(!1)}}},[V,eP,B,eS,F,er,es,ed,eY,null==W||null==(t=W.conversationSettings)?void 0:t.create_mode,eR]),e7=(0,p.useCallback)(()=>{var e;return null==(e=$.current)?void 0:e.focus()},[$]),[e8,e9]=p.useState(!1),te=(0,a.cV)(),tt=(0,u.u9)(),[tn,tr,ts,ti,ta,to,tl,tu]=(0,s.Si)({syncSourceCount:ei.length,attachments:er,setAttachments:ea,numExistingConversationAttachments:null!=(L=null==W?void 0:W.attachmentsSoFar)?L:0,files:es,setFiles:eo,numExistingConversationFiles:null!=(R=null==W?void 0:W.files.length)?R:0,detectSameAttachment:()=>!1,selectedModel:eO,conversationUuid:null==W?void 0:W.id,blobFileUploadsEnabled:te,wiggleEnabled:null!=tt&&tt}),tc=er.length+es.length,td=ei.length,tm=tn||ef||eh,tp=tc>0||td>0||tm,tg=(0,p.useCallback)(e=>{switch(e.action){case"focusInput":e7();break;case"improvePrompt":e4();break;case"sendMessage":e1();break;case"setAttachments":ea(e.value);break;case"setCurrentCompassTask":eM(e.value);break;case"setFiles":eo(e.value);break;case"setHasBlockingWarning":e9(e.value);break;case"setIncludeProfilePreferences":eC(e.value);break;case"setIsModelSelectorOpen":e_(e.value);break;case"setIsUploadingDriveSync":ek(e.value);break;case"setIsUploadingFile":tr(e.value);break;case"setIsUploadingGithubSync":ex(e.value);break;case"setModel":e3(e.value);break;case"setPendingConversationSettings":eF(e.value);break;case"setPersonalizedStyle":ew(e.value);break;case"setProjectUuid":eW(e.value);break;case"setPrompt":{var t;let n=e.value;V.getState().setPrompt(null!=(t=null==n?void 0:n.text)?t:"",null==n?void 0:n.options)}break;case"setSyncSourceUuids":el(e.value);break;case"setTipTapEditorState":V.getState().setTipTapEditorJSON(e.value);break;case"stopSampling":en()}},[e7,e4,e1,ea,eM,eo,e9,eC,e_,ek,tr,ex,e3,eF,ew,eW,el,en,V]),tf=(0,p.useMemo)(()=>{var t;return{files:e.willRedirectOnSubmit&&eg?null!=eJ?eJ:[]:es,isAtMaxNumUploads:em,isUploadingDriveSync:ef,isUploadingGithubSync:eh,model:eO,isChatSyncing:ec,personalizedStyle:ev,isProjectSyncing:eq,isNewConversation:void 0===W||0===W.messagesSoFar,isProjectLocked:void 0!==q||void 0!==W,isSending:eg,setModel:e3,setProjectUuid:eW,sendMessage:e1,sendTransparentMessage:e2,improvePrompt:e4,isImprovingPrompt:e5,stopSampling:en,conversation:W,focusInput:e7,promptInputRef:$,willRedirectOnSubmit:null!=(t=e.willRedirectOnSubmit)&&t,hasBlockingWarning:e8,setHasBlockingWarning:e9,setPersonalizedStyle:ew,setIsUploadingDriveSync:ek,setIsUploadingGithubSync:ex,includeProfilePreferences:ey,setIncludeProfilePreferences:eC,pendingConversationSettings:eR,setPendingConversationSettings:eF,isUploadingFile:tn,setIsUploadingFile:tr,validateMaxUploadLimit:ts,onDrop:ti,onPasteFiles:ta,handleUpload:to,uploadInputProps:tu,hasAttachments:tp,isModelSelectorOpen:ep,setIsModelSelectorOpen:e_,currentCompassTask:eb,setCurrentCompassTask:eM,dynamicAction:tg}},[W,es,e7,q,e8,ey,em,ec,eq,eg,ef,eh,eO,ev,eW,e.willRedirectOnSubmit,e1,e2,e4,e5,e3,eR,eF,en,eJ,tn,tr,ts,ti,ta,to,tu,tp,ep,e_,eb,eM,eC,ek,ex,ew,tg]);return(0,r.jsx)(j.jM,{value:V,children:(0,r.jsx)(A.Provider,{value:tf,children:K})})}},96769:(e,t,n)=>{function r(e){return e.replace(/(^|\n)(\s?)•(\s?)/g,"$1$2- ")}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"markdown-document",n=e.indexOf("```");if(-1===n||-1===e.indexOf("```",n+3))return e;let r=[...e.matchAll(/^(\s*)(```+)(.*)$/gm)];if(0===r.length)return e;let s=new Map,i=e=>{let t=s.get(e);return void 0===t&&(t="`".repeat(e),s.set(e,t)),t},a=[];for(let e of r){var o;let[t,n,r,s]=e,i=null!=(o=e.index)?o:0;a.push({index:i,length:t.length,backtickCount:r.length,indent:n,info:s.trim(),depth:0})}let l=[];for(let e=0;e<a.length;e++){let n=a[e];if(""!==n.info){n.depth=l.length,l.push(e);continue}if(0===l.length){n.depth=0,l.push(e);continue}let r=a[l[l.length-1]];if(n.backtickCount<r.backtickCount){n.depth=l.length,l.push(e);continue}let s=!0;if("code-in-markdown"===t&&1===l.length){let t=-1;for(let r=e+1;r<a.length&&""===a[r].info;r++)if(a[r].backtickCount===n.backtickCount){t=r;break}if(-1!==t){for(let e=t+1;e<a.length;e++)if(a[e].backtickCount>=r.backtickCount){s=!1;break}}}s?(n.depth=l.length-1,r.closingFenceIndex=e,l.pop()):(n.depth=l.length,l.push(e))}let u=new Map,c=0;for(let e of a){let t=u.get(e.depth)||3;u.set(e.depth,Math.max(t,e.backtickCount)),c=Math.max(c,e.depth)}for(let e=c-1;e>=0;e--){let t=u.get(e)||3,n=u.get(e+1)||0;n>=t&&u.set(e,n+1)}let d=new Map;for(let e of a){let t=u.get(e.depth)||3;if(t>e.backtickCount&&d.set(e.index,{index:e.index,length:e.length,replacement:"".concat(e.indent).concat(i(t)).concat(e.info)}),void 0!==e.closingFenceIndex){let n=a[e.closingFenceIndex];n.backtickCount!==t&&d.set(n.index,{index:n.index,length:n.length,replacement:"".concat(n.indent).concat(i(t))})}}if(0===d.size)return e;if(1===d.size){let[{index:t,length:n,replacement:r}]=d.values();return e.slice(0,t)+r+e.slice(t+n)}let m=Array.from(d.values()).sort((e,t)=>e.index-t.index),p=[],g=0;for(let{index:t,length:n,replacement:r}of m)p.push(e.slice(g,t)),p.push(r),g=t+n;return p.push(e.slice(g)),p.join("")}function i(e){return e.replace(/\\/g,"\\\\")}n.d(t,{Dn:()=>a,Gm:()=>i,UT:()=>s,tH:()=>r});let a=e=>{let t=e.match(/\n+/g),n=t?t.length:0,r=e.match(/\n{2,}/g),s=r?r.length:0;return{multipleNewlineCount:s,singleNewlineCount:n-s}}}}]);